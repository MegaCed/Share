MAJ: 16/03/2020



	* Procédures ************************
	* SQL *******************************
	* SPL (Splunk) **********************
	* Développements ********************
	* Divers ****************************
	* To Do *****************************



	* Procédures ************************************************************************************************************
*********************************************************************************************************************************

	Création d'un nouveau Workspace ISO from scratch (01/2018)
--------------------------------------------------------

	Fichiers nécessaires:
H:\My Documents\Procedures\Latest ISO Environment\

Installer Java 8:
	jdk-8u151-windows-x64.exe
	P:\Tools\Java\jdk1.8_u151\

Récupération du Workspace avec Git...
	P:\Workspaces\ISO_GIT_NEW\

Lancer:
	clone_projects.bat
	checkout_develop.bat

Build Maven:
	cd RDODevelopmentUtilities\MasterBuild\
	set java_home=C:\Tools\java\jdk1.6.0_33
	mvn --settings "C:\Users\524286135\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install
	[mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install]
	
	cd TorTOMService\RDISTorTOMComponent
	mvn --settings "C:\Users\524286135\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install
	[mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install]

Eclipse:
	C:\Tools\eclipse
	[P:\Tools\Applications\Eclipse\eclipse Oxygen\]

Eclipse shortcut arguments:
	"P:\Tools\Applications\Eclipse\eclipse Oxygen\eclipse.exe" -vm "P:\Tools\Java\jdk1.8_u151\bin\javaw.exe"

Importer le nouveau Workspace:
	Import -> Existing Maven Projects

Fermer projet "PomUpdater".

Eclipse: Window -> Preferences:
	Maven - Installations:	C:\localapp\apps\SF-1.6.0-x64\Maven			[P:\Tools\Development\SF-1.6.0-x64\Maven]
	Global Settings:	C:\Users\524286135\.m2\settings-for-maven3.xml		[C:\Users\ek706\.m2\settings-for-maven3.xml]
	User Settings:		C:\Users\524286135\.m2\settings-for-maven3.xml		[C:\Users\ek706\.m2\settings-for-maven3.xml]
	Installed JREs:		C:\Program Files\Java\jdk1.8.0_201			[P:\Tools\Java\jdk1.6.0_33]
	Compiler:									[JDK Compliance 1.6]
	Building:		[ ] Abord build when build path errors occur

Remplacer les fichiers:
	H:\My Documents\Procedures\Latest ISO Environment\ISO files to be replaced\

	\RDObase\RDISmodel\src\main\java\com\rbcdexia_is\rdis\investor\model\		-> FTPHost.java
	\RDObase\RDISmodel\src\main\java\com\rbcdexia_is\rdis\investor\model\config\	-> ConfigurationExternal.java
	\RDObase\RDISmodel\src\main\java\com\rbcdexia_is\rdis\investor\model\sso\	-> AbstractSsoSystemInformation.java
	\RDObase\RDISmodel\src\main\java\com\rbcdexia_is\rdis\investor\model\sso\	-> SsoSystemInformation.java
	\RDObase\RDISutils\src\main\resources\						-> applicationContext-jasypt.xml

Builder RDISMessage (Skip tests).

Sélectionner tous les projets -> Maven -> Update Project...

(Faire un milliard de "Maven Clean", "Maven Install", "Update Maven Dependencies", ...
Clic clic clic clic clic clic clic clic clic clic clic - Viel est un cul, UN CUL - clic clic clic clic clic clic clic clic clic clic)

Glassfish:
	P:\Tools\Development\glassfish4\

Création d'un nouveau serveur: GlassFish
Utilisant Java 8!
Clic droit sur le serveur -> Monitoring -> Properties -> GlassFish -> [v] Use JAR archives for deployment

VM Arguments du serveur:
	-Doracle.mds.cache=simple -Xms256m -Xmx512m -XX:MaxPermSize=256m -Dorg.apache.tapestry.disable-caching=true -DRDISinvestor.default.userid=Root -DRDISinvestor.default.password=password -Ddisable.ssl=true -Denable.webtest.home=true -Dwebtest.history.dir=C:/TEMP/webtest_history -DinstanceName=Inst1 -DEDEN_ENV=local -Dredirect=false -DinstanceName=Inst1

Add Projects to server!
-> Add and Remove...

Le serveur est déployé sous:
	P:\Tools\Development\glassfish4\glassfish\domains\domain1\applications

Console d'administration GlassFish:
	http://localhost:4848

Mettre la BD à jour...

Clean server GlassFish
Vérifier qu'il ne déploie pas de la merde et potentiellement virer tout ce qu'il y a dans:
	P:\Tools\Development\glassfish4\glassfish\domains\domain1\applications\
	P:\Tools\Development\glassfish4\glassfish\domains\domain1\applications\__internal\

Si le Publish foire et se plaint qu'il ne trouve pas une classe (ex: DefaultHttpSessionListener), il faut regarder dans quel projet est cette classe (ex: RDISinvestorServices).
Ensuite, il faut vérifier dans le Deployment Assembly du projet "RDISinvestorWeb" que "RDISinvestorServices" est bien dans la liste et le rajouter si nécessaire!



	Mises en Tests (MET)
----------------------

Ex: passer de "49.1.0-SNAPSHOT" vers "49.2.0-SNAPSHOT"...
Et "0.49RC1" en "0.49RC2"

(Git doit être dans le Path)
Pour changer les variables d'environnement:
	C:\System32\SystemPropertiesAdvanced.exe

Workspace temporaire de Builds:
	P:\Workspaces\MET\

Avec un Shell, récupérer tous les projets (~10 min):
	Se placer dans le bon répertoire
	clone_projects.bat
	checkout_develop.bat

Aller vérivier le contenu d'un "POM.xml":
	...
	<version>49.1.0-SNAPSHOT</version>
	...

Mettre à jour la version:
	pomUpdater.bat 49.1.0-SNAPSHOT 49.1.0

Build du Web (~35 min):
	cd RDODevelopmentUtilities\MasterBuild
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true deploy

Build du TOMService (~5 min):
	cd TorTOMService\RDISTorTOMComponent
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true deploy

Les fichiers SQL sont dans:
	RDObase\RDISinvestorCommon\src\test\resources\database\rdis\
Récupérer un vieux fichier et l'adapter pour y injecter les dernières révisions:
	RDISinvestorV047RC02toV049RC01.sql
Attention à la numérotation!! ET IL FAUT L'ATTACHER AU MAIL!
Et ne pas oublier de changer les "${semicolon}" en ";"!

Afficher les fichiers à commiter:
	check_files_to_commit.bat

Commit:
	commit_and_push.bat "ISO version 3.22 CD1"

Avec Git Bash, changer la version du Drop:
	cd p:/Workspaces/MET
	perl change_code_drop_version.pl 0.49RC1 0.49RC2

Vérifier le n° de version d'un des fichiers:
	RDODevelopmentUtilities\MasterBuild\buildProperties\RDObuild.properties

Incrémenter le n° de version vers une Snapshot:
	pomUpdater.bat 49.1.0 49.2.0-SNAPSHOT

Re-vérification des fichiers:
	check_files_to_commit.bat

Commit:
	commit_and_push.bat "49.2.0-SNAPSHOT"

Check dans Nexus:
	http://rbcnexus.fg.rbc.com:8081/nexus/content/repositories/zxn0-releases/com/rbcdexia_is/rdis/web/RDISinvestorWeb/49.1.0/

Compléter document Word en mettant à jour les numéros de versions:
	ISO Release 3-22-1.doc
+ Mail à Giam!

Finalement, virer tous les répertoires du Workspace de build, dans:
	P:\Workspaces\MET\

Relancer les builds dans Jenkins:
	Arrêter tous les builds en cours (connecté en "iso-admin" -> crois rouge à côté des Builds)
	Relancer le build du Framework Intelliware (ZXN0-FS -> IntelliwareFramework -> develop -> Build Now)



	GitHub / Nexus
----------------------

------- Procédure de mise à jour du Workspace

Le Workspace est situé sous:
	P:\Workspaces\ISO_GIT\

Ouvrir tous les composants 1 à 1 dans SourceTree, puis:
	Vérifier qu'on est bien sur la branche "Develop"
	Fetch
	[Commit]
	Pull
	[Push]

Puis refaire un build de tout le bazard...
	cd \Workspaces\ISO_GIT\RDODevelopmentUtilities\MasterBuild
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install
	
	cd \Workspaces\ISO_GIT\TorTOMService\RDISTorTOMComponent
	mvn --settings "C:\Users\ek706\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install

Dans Eclipse:
	Refresh
	Clean

Et voilou!


Fetch:		MAJ des informations du Pull
Discard:	Ecraser notre version locale avec celle du serveur
Stop Tracking:	Pour ne plus être emmerdé par les .classpath

Pour ajouter un projet dans SourceTree:
	File -> Open... -> Select Folder


------- Mettre à jour un fichier tout con...

Si nécessaire:
git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/RDODevelopmentUtilities.git
git checkout develop

[Modification du fichier sur le filesystem...]

cd [Workspace]
cd [git repository]

git status
git add [chemin du fichier]
git add ...
git add ...

git commit -m "Commentaire"

[S'il fait chier] git pull

git push


------- Merger 2 branches Git

1. Récupérer la branche "cible":
	git checkout cs2.0
[
   Et si elle n'existe pas...
	git checkout -b cs2.0
   Et là, il n'y a plus qu'à la commiter...
	git push --set-upstream origin cs2.0
]

2. Effectuer le merge de la branche contenant les modifications:
	git merge origin/cs1.3

3. S'assurer qu'il n'y a pas de conflits à résoudre après le merge...

4. Commiter les modifications:
	git add .
	git commit -m "Branch Merge"
	git push


------- Commandes pratiques

git pull = git fetch + git merge

Voir l'historique des modifications d'un fichier:
	git log [fichier]

Voir les modifications sur ce fichier particulier:
	git show [hash]

Annuler des modifications dont je n'ai rien à en foutre:
	git checkout [fichier]

Force git pull to overwrite local files:
	git fetch --all
	git reset --hard origin/develop
	[git reset --hard origin/master]

Ecraser un fichier local avec la version du Repository:
	git checkout origin/master [path/to/file]

En cas d'erreur lord d'un switch de branche (error: Your local changes to the following files would be overwritten by checkout):
	git checkout -f branch


------- Liens

	Dashboard
http://ulviasp00003.fg.rbc.com:8085/view/Build-Monitor-Develop/

	Git
https://rbcgithub.fg.rbc.com/ZXN0-ISO
https://rbcgithub.fg.rbc.com/ZXN0-FS
https://rbcgithub.fg.rbc.com/ZXN0-VF

	Jenkins (Citrix)
http://ulviasp00003.fg.rbc.com:8085

	Nexus
http://rbcnexus.fg.rbc.com:8081/nexus/content/repositories/zxn0-releases
http://rbcnexus.fg.rbc.com:8081/nexus/content/repositories/zxn0-snapshots

	Maven (OBSOLETE)
C:\localapp\.m2\settings-for-maven3.xml

	Répertoire de travail
C:\Users\ek706\projects


------- Divers

	Tuto Git
https://rbcgithub.fg.rbc.com/u0r0-REG/registry-wiki/wiki/GIT-Workshop

	Readme Migration Script
https://rbcgithub.fg.rbc.com/u0r0-DevOps/iso-migration-script

	RTC
C:\localapp\Specifics\Applications\RTC-SCM
	SCM.INI
C:\localapp\Specifics\Applications\RTC-SCM\jazz\scmtools\eclipse\

	Test
/c/localapp/Specifics/Applications/RTC-SCM/jazz/scmtools/eclipse/scm.exe login -r https://rbcis-sf.fg.rbc.com/ccm/ -u 524286135 -P Bozo888

	Création clé SSH
https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/
ssh-keygen -t rsa -b 4096 -C "cedric.leburton@rbc.com"

Le Java 64 bits utilisé est:
	C:\Program Files (x86)\Java\jdk1.6.0_45\bin\java.exe

Le script de migration est:
	Migration.pl
Le script de migration SANS HISTORIQUE est:
	LoadComponents.pl



	* SQL *******************************************************************************************************************
*********************************************************************************************************************************

------- Utiliser un schema spécifique

-- PROD
ALTER SESSION SET current_schema = RZXN0EWF;

-- QA
ALTER SESSION SET current_schema = RZXN0EWFSTG;

-- QA (OPES)
ALTER SESSION SET current_schema = RXRR0OPESSTG;


------- Paramètres des rapports

-- Retrouver un favori
SELECT *
FROM report_schedule_inst
WHERE favourite_name LIKE 'test1'
ORDER BY run_start_date DESC
;

-- Retrouver les paramètres effectivement utilisés pour la génération d'un raport
SELECT *
FROM vw_report_schedule_inst_param
WHERE report_schedule_inst_id = 791498
;

-- Retrieve what report uses a specific Parameter (dropdown)
SELECT DISTINCT RS.report_name
FROM PARAMETER_LOOKUP_CACHE PLC, REPORT_PARAMETER_ENUM_ITEM RPEI, REPORT_PARAM RP, REPORT_PARAM_GROUP RPG, REPORT_SIR RS
WHERE PLC.PARAMETER_LOOKUP_CACHE_ID = RPEI.PARAM_LOOKUP_ID
AND RPEI.report_param_enum_id = RP.id
AND RP.REPORT_PARAM_GROUP_ID = RPG.ID
AND RPG.REPORT_ID = RS.ID
AND PLC.QUALIFIER = 'CES_MAN_VOL'
;


------- Liste des Support Users

SELECT DISTINCT user_id
FROM support_role_user
;


------- Liste des rapports

-- TRUST
SELECT DISTINCT report_name
FROM report_sir
WHERE report_data_source_id IN (5, 6, 8)
ORDER BY report_name
;

-- BANK (Interactifs)
SELECT report_name, technical_name, interactive_report_type, name
FROM report_sir RS, report_data_source RDS
WHERE RS.REPORT_DATA_SOURCE_ID = RDS.REPORT_DATA_SOURCE_ID
AND RDS.report_data_source_id IN (1, 2, 3)
AND report_enabled_status <> 'DELETED'
ORDER BY REPORT_NAME
;

-- BANK (PGR)
SELECT DISTINCT NAME, DOMAIN_CODE
FROM DFS_REPORT_MASTER DRM
WHERE ENABLED = 'Y'
AND dummy = 'N'
ORDER BY name
;


------- CES

-- Companies avec ces permissions
SELECT C.company_name "Company", VCPI.permission_id "Permission"
FROM vwp_company_perm_implied VCPI, company C
WHERE VCPI.company_id = C.company_id
AND permission_id IN ('companyAdmin.manageCESnotifications', 'companyAdmin.manageSecurityGroup')
ORDER BY C.company_name, VCPI.permission_id
;

-- Roles avec ces permissions
SELECT RR.description "Role", AG.description "Account Group", C.company_name "Company", RP.permission_id "Permission"
FROM account_group AG, role_account_group RAG, role_permission RP, company C, rdis_role RR
WHERE AG.account_group_id = RAG.account_group_id
AND RAG.role_id = RP.role_id
AND AG.company_id = C.company_id
AND RAG.role_id = RR.role_id
AND AG.account_group_type = 'SECURE'
AND RP.permission_id IN ('companyAdmin.manageCESnotifications', 'companyAdmin.manageSecurityGroup')
ORDER BY C.company_name, RR.description, AG.description, RP.permission_id
;


------- Liste des Roles et Permissions pour tous les Users d'une Company

SELECT C.company_name company_name, RU.user_id user_identifier, RU.email_address user_email, RR.description role_description, RP.permission_id permission_identifier
FROM company C, rdis_user RU, user_role UR, role_permission RP, rdis_role RR
WHERE C.company_id = [xxx]
AND RU.company_id = C.company_id
AND RU.user_id = UR.user_id
AND UR.role_id = RP.role_id
AND UR.role_id = RR.role_id
AND C.company_enabled_status = 'ENABLED'
AND RU.user_enabled_status = 'ENABLED'
ORDER BY user_email, role_description, permission_identifier
;


------- Query for the company - promoter / corporate links

SELECT company_name, city, user_group_type, user_group_id, user_group_name
FROM (
	(
		SELECT A.company_name, A.city, 'PROMOTER' user_group_type, '' || C.dfs_promoter_id user_group_id, C.promoter_name user_group_name
		FROM company A, company_dfs_promoter B, dfs_promoter C
		WHERE A.company_enabled_status <> 'DELETED'
		AND A.company_id = B.company_id
		AND B.dfs_promoter_id = C.dfs_promoter_id
	) UNION (
		SELECT A.company_name, A.city, 'CORPORATE' user_group_type, C.vf_corp_id user_group_id, C.description user_group_name
		FROM company A, company_vf_company B, vf_company C
		WHERE A.company_enabled_status <> 'DELETED'
		AND A.company_id = B.company_id
		AND B.vf_corp_id = C.vf_corp_id
	) UNION (
		SELECT A.company_name, A.city, 'NO PROM + NO CORP' user_group_type, '' user_group_id, '' user_group_name
		FROM company A
		WHERE A.company_enabled_status <> 'DELETED'
		AND A.company_id NOT IN (
			SELECT company_id
			FROM company_dfs_promoter
		)
		AND A.company_id NOT IN (
			SELECT company_id
			FROM company_vf_company
		)
	)
);


------- Query for the company - permission links

SELECT A.company_name, A.city, C.permission_id, C.description
FROM company A, permission_entitlement B, permission C
WHERE A.company_enabled_status = 'ENABLED'
AND A.company_id = B.company_id
AND B.permission_id = C.permission_id
ORDER BY A.company_name, C.permission_id
;


------- Retrouver les File Upload ISO

-- Dans la "Table Magique" de la base STP...
SELECT *
FROM ta_group TG, ta_group_external_ref TGER
WHERE TG.grp_id = tger.ext_grp_id
AND grp_name <> 'UNKNOWN'
;

-- Number of uploads per client
SELECT COUNT(*) as Count, C.company_name as Company
FROM txn_file_upload_meta_data TFUMD, company C
WHERE TFUMD.company_id = C.company_id
AND TFUMD.entity = 'TRUST'
AND TFUMD.company_id IS NOT NULL
GROUP BY C.company_name
ORDER BY C.company_name
;

-- Number of successful Uploads per day
SELECT COUNT(*) as Count, TO_CHAR(upload_date, 'yyyy/mm/dd') as Upload
FROM txn_file_upload_meta_data
WHERE entity = 'TRUST'
AND company_id IS NOT NULL
GROUP BY TO_CHAR(upload_date, 'yyyy/mm/dd')
ORDER BY TO_CHAR(upload_date, 'yyyy/mm/dd') DESC
;


------- Retrouver qui a encodé une transaction dans ISO

-- Si on a du bol, on peut les retrouver dans la table des Approvals
SELECT *
FROM txn_approve_req
WHERE gateway_transaction_id IN (125807014, 125807055)
;

-- Retrouver les transactions et leurs groupes dans le STP
SELECT *
FROM ta_message
WHERE msg_id IN ('125807014', '125807055')
;

-- Retrouver les informations dans la "Table Magique" du STP
SELECT *
FROM ta_group_external_ref
WHERE ext_grp_id IN ('7461474', '7461490')
;


------- Provide the current active users list for "Barclays Bank Plc" with entitlements

SELECT USR.first_name, USR.last_name, USR.user_name, USR.email_address, USR.created_date, USR.last_successful_login_date, RP.permission_id, ROL.description, PERM.permission_id, PERM_DESC(perm.permission_id)
FROM rdis_user USR, user_role UR, role_permission RP, rdis_role ROL, permission PERM
WHERE USR.company_id = 375
AND UR.role_id = RP.role_id
AND USR.user_id = UR.user_id
AND ROL.role_id = UR.role_id
AND PERM.permission_id = RP.permission_id
;


------- Tous les comptes d'une company

SELECT *
FROM vw_company_account
;


------- Liste de Accounts Fund Admin (CPTA) et Global Custody (BD)

SELECT *
FROM dfs_account_dfs_product
WHERE dfs_domain_code IN ('CPTA', 'BD')
ORDER BY dfs_account_id
;


------- Les Accounts disponibles pour un user

SELECT RU.user_name, A.account_id, A.legal_name, A.account_number
FROM rdis_user RU, user_role UR, role_account_group RAG, account_group_account AGA, account A
WHERE RU.user_name LIKE '%BCIMUser3%'
AND RU.user_id = UR.user_id
AND UR.role_id = RAG.role_id
AND RAG.account_group_id = AGA.account_group_id
AND AGA.account_id = A.account_id
ORDER BY A.account_id
;


------- Les Accounts liés à un favori particulier

SELECT *
FROM SIR_FAV_VALUE_ACCT
WHERE sir_favourite_value_id IN (
  SELECT sir_favourite_value_id
  FROM sir_favourite_value
  WHERE sir_favourite_id = (
    SELECT sir_favourite_id
    FROM sir_favourite
    WHERE name = 'A1_Agg1_PDF'
  )
);


------- Les utilisateurs actifs

SELECT COUNT(*)
FROM rdis_user
WHERE user_enabled_status = 'ENABLED'
AND password_change_required = 'N'
-- Internes
-- AND user_name LIKE '%@rbc.com'
-- Externes
-- AND user_name NOT LIKE '%@rbc.com'
;


------- Rapports DFS et leurs associations à des Companies

-- Are the Reports permissioned in ISO??
--> List of "Document - Permission"
SELECT doc_name, permission_id
FROM DFS_REPORT_MASTER DRM
WHERE DOC_NAME IN ('XB11P731GCMTRX', 'XBD11247AUACAS', 'XBD1P731FAILED', 'XBD21247AUASEC', 'XBD2P163INVEST', 'XBD2P731TRADES', 'XBD31247AUADEP', 'XBD3P163SECLND', 'XBD3P731TIMEDP', 'XBD41247EXRATE', 'XBD4P731EXCHAN', 'XBD6P731STITDU')
ORDER BY doc_name
;

-- For what Companies are they linked??
--> Set of Companies "really" associated to the Documents
SELECT C.COMPANY_NAME, DRM.DOC_NAME, PEI.PERMISSION_ID
FROM DFS_REPORT_MASTER DRM, company C, permission_entitlement_implied PEI
WHERE DRM.PERMISSION_ID = PEI.PERMISSION_ID
AND C.company_id = PEI.company_id
AND DOC_NAME IN ('XB11P731GCMTRX', 'XBD11247AUACAS', 'XBD1P731FAILED', 'XBD21247AUASEC', 'XBD2P163INVEST', 'XBD2P731TRADES', 'XBD31247AUADEP', 'XBD3P163SECLND', 'XBD3P731TIMEDP', 'XBD41247EXRATE', 'XBD4P731EXCHAN', 'XBD6P731STITDU')
AND DRM.PERMISSION_ID IS NOT NULL
ORDER BY C.company_name, DRM.doc_name
;


------- Rapports PGR (Bank, Trust) permissionés pour une Company

-- Trust PGRs
SELECT DISTINCT C.COMPANY_NAME, VCVR.REPORT_NAME, PEI.PERMISSION_ID
FROM COMPANY C, permission_entitlement_implied PEI, VW_COMPANY_VF_REPORT VCVR
WHERE (COMPANY_NAME LIKE 'Vontobel Asset Management S.A.'
OR COMPANY_NAME LIKE 'BANK VONTOBEL AG')
AND C.COMPANY_ID = PEI.COMPANY_ID
AND PEI.PERMISSION_ID = VCVR.PERMISSION_ID
ORDER BY C.COMPANY_NAME, VCVR.REPORT_NAME, PEI.PERMISSION_ID
;

-- Trust Tax Reports
SELECT DISTINCT C.COMPANY_NAME, VCVTR.REPORT_NAME, PEI.PERMISSION_ID
FROM COMPANY C, permission_entitlement_implied PEI, VW_COMPANY_VF_TAX_REPORT VCVTR
WHERE (COMPANY_NAME LIKE 'Vontobel Asset Management S.A.'
OR COMPANY_NAME LIKE 'BANK VONTOBEL AG')
AND C.COMPANY_ID = PEI.COMPANY_ID
AND PEI.PERMISSION_ID = VCVTR.PERMISSION_ID
ORDER BY C.COMPANY_NAME, VCVTR.REPORT_NAME, PEI.PERMISSION_ID
;

-- Trust Statements Reports
SELECT DISTINCT C.COMPANY_NAME, VCVTSA.REPORT_NAME, PEI.PERMISSION_ID
FROM COMPANY C, permission_entitlement_implied PEI, VW_COMPANY_VF_TRUST_STMT_ALL vcvtsa
WHERE (COMPANY_NAME LIKE 'Vontobel Asset Management S.A.'
OR COMPANY_NAME LIKE 'BANK VONTOBEL AG')
AND C.COMPANY_ID = PEI.COMPANY_ID
AND PEI.PERMISSION_ID = VCVTSA.PERMISSION_ID
ORDER BY C.COMPANY_NAME, vcvtsa.REPORT_NAME, PEI.PERMISSION_ID
;

-- Bank PRGs
SELECT DISTINCT C.COMPANY_NAME, DRM.DOC_NAME, PEI.PERMISSION_ID
FROM DFS_REPORT_MASTER DRM, COMPANY C, PERMISSION_ENTITLEMENT_IMPLIED PEI
WHERE (COMPANY_NAME LIKE 'Vontobel Asset Management S.A.'
OR COMPANY_NAME LIKE 'BANK VONTOBEL AG')
AND DRM.PERMISSION_ID = PEI.PERMISSION_ID
AND C.company_id = PEI.company_id
AND DRM.PERMISSION_ID IS NOT NULL
ORDER BY C.COMPANY_NAME, DRM.DOC_NAME
;


------- Boosty: construire une liste de 2 colonnes: une liste de valeurs & le fait qu'elles sont bien présente dans la table...

SELECT B.my_custom_list AS "User Name", A.user_id AS "User ID"
FROM (
	SELECT REGEXP_SUBSTR('Root,titi','[^,]+', 1, LEVEL) my_custom_list FROM DUAL
	CONNECT BY REGEXP_SUBSTR('Root,titi', '[^,]+', 1, LEVEL) IS NOT NULL
) B
LEFT OUTER JOIN RDIS_USER A
	ON A.first_name = B.my_custom_list
GROUP BY B.MY_CUSTOM_LIST, A.USER_ID
ORDER BY B.MY_CUSTOM_LIST
;


------- Trouver les données ayant une taille inférieure à une certaine valeur

SELECT *
FROM BIC_REFERENCE
WHERE LENGTH(TRIM(bic_code)) < 11
;


------- Dupliquer des lignes en modifiant une de leur valeur

INSERT INTO bic_reference (BIC_REF_ID, BIC_CODE, BIC_BROKER_NAME, BROKER_CITY, BROKER_ADDRESS_1, BROKER_ADDRESS_2, BROKER_ADDRESS_3, BROKER_ADDRESS_4, BROKER_STATE_OR_PROV, STATE_OR_PROV_ID, COUNTRY_ID, POSTAL_ZIP_CODE, BIC_TYPE, STATUS, BANCS, T2S_FOCUS, T2S_MILVUS)
SELECT bic_code_seq.nextval, BIC_CODE || 'XXX', BIC_BROKER_NAME, BROKER_CITY, BROKER_ADDRESS_1, BROKER_ADDRESS_2, BROKER_ADDRESS_3, BROKER_ADDRESS_4, BROKER_STATE_OR_PROV, STATE_OR_PROV_ID, COUNTRY_ID, POSTAL_ZIP_CODE, BIC_TYPE, STATUS, BANCS, T2S_FOCUS, T2S_MILVUS
FROM bic_reference
WHERE BIC_REF_ID IN (3124, 3125, 3126)
;


------- Confidentiality Breach: vérifier si la Company '3318' a utilisé un des Accounts listés lors d'une génération de rapports

SELECT *
FROM REPORT_SCHEDULE_INST A, 
	VW_REPORT_SCHEDULE_INST_PARAM B, 
	RPT_SCHED_INST_PARAM_ACCT C
WHERE A.report_schedule_inst_id = B.report_schedule_inst_id
AND B.REPORT_SCHEDULE_INST_PARAM_ID = C.REPORT_SCHEDULE_INST_PARAM_ID
AND C.ACCOUNT_ID IN (
	SELECT ACCOUNT_ID 
	FROM VW_COMPANY_ACCOUNT 
	WHERE ACCOUNT_ID IN (
		25457056,
		25883320,
		25883320
	)
)
AND company_id = 3318
;



	* SPL (Splunk) **********************************************************************************************************
*********************************************************************************************************************************

	Logs (& Errors)
-----------------------

------- System.out (avec quelques minutes de retard...)

-- Dev
index="iso_it_dev"

-- QA
index="iso_it_qa" sourcetype="iso_it_sysout"
index=* host=uaefcd01
index="iso_it_qa" sourcetype="iso_it_sysout"
| sort _time

index="iso_it_qa" sourcetype=iso_pcf

-- Prod
index="iso_it" sourcetype="iso_it_sysout"
| sort _time

index="iso_it" sourcetype=iso_pcf

-- EPR
index=twu0


------- OutOfMemory

-- Retrouver les OutOfMemory errors par jour
index="iso_it" sourcetype="iso_it_sysout" "Caused by: java.lang.OutOfMemoryError: Java heap space"
| timechart span="1d" count


-- Ne garder que la première occurence par jour
index="iso_it" sourcetype="iso_it_sysout" "Caused by: java.lang.OutOfMemoryError: Java heap space"
| eval date=strftime(_time,"%x")
| sort _time
| dedup date
| table _time


-- Graphique du nombre d'OutOfMemoryError par jour
index="iso_it" sourcetype="iso_it_sysout" "OutOfMemoryError"
| timechart span=1d count



	Pages
-------------

------- Les pages visitées pour une company particulière

index="iso_wa" sourcetype="iso_wa_pages"
| search nv_cpy_id = 716
| sort nv_pg_visited
| transaction nv_sess_id
| table nv_date, nv_cpy_id, nv_usr_id, nv_pg_tit, eventcount, nv_sess_id


-- ... Avec plus de détails, sans 'Transaction'
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_cpy_id = 716
| table nv_date, nv_cpy_id, nv_usr_id, nv_sess_id, nv_pg_tit
| sort nv_sess_id


------- Toutes les connexions des Users d'une Company

index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| search COMPANY_NAME = "*Danske*" nv_pg_visited = 1
| eval time=_time
| convert timeformat="%d/%m/%y %H:%M:%S.%3N" ctime("time")
| table time, USER_NAME, COMPANY_NAME
| sort time


-- Idem sans le nouvel élément "nv_pg_visited"
index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| search COMPANY_NAME = "DANSKE BANK INTERNATIONAL SA"
| eval time=_time
| convert timeformat="%d/%m/%y %H:%M:%S.%3N" ctime("time")
| dedup nv_sess_id
| table time, USER_NAME, COMPANY_NAME, nv_sess_id
| sort time


-- Idem avec des Stats
index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| search COMPANY_NAME = "DANSKE BANK INTERNATIONAL SA"
| eval time=_time
| convert timeformat="%d/%m/%y %H:%M:%S.%3N" ctime("time")
| stats first(time) as Date, values(USER_NAME) as UserName, values(COMPANY_NAME) as CompanyName by nv_sess_id
| table Date, UserName, CompanyName 
| sort Date


------- OS utilisés par les clients

-- Statistiques globales
index="iso_wa" sourcetype="iso_wa_pages"
| dedup nv_sess_id
| lookup http_user_agent http_user_agent as nv_usr_agt
| stats count as sessions by ua_platform_description


-- Pour CHAQUE client
index="iso_wa" sourcetype="iso_wa_pages"
| stats values(nv_usr_agt) as nv_usr_agt, values(nv_usr_id) as nv_usr_id, values(nv_cpy_id) as nv_cpy_id by nv_sess_id
| dedup nv_usr_id
| lookup http_user_agent http_user_agent as nv_usr_agt
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| table ua_platform_description, USER_NAME, COMPANY_NAME
| sort COMPANY_NAME, USER_NAME


------- Statistiques des Browsers utilisés

index="iso_wa" sourcetype="iso_wa_pages"
| dedup nv_sess_id
| lookup http_user_agent http_user_agent as nv_usr_agt
| eval ua_version = if (ua_version == 0.0, "", ua_version)
| eval browser_name = ua_browser + " " + ua_version
| eval browser_name = if(isnull(browser_name), "Unknown browser", browser_name)
| stats count by browser_name
| eventstats sum(count) as total
| eval percentage = round(count * 100 / total, 2)."%"
| table browser_name, count, percentage


------- Browsers utilisés par les clients (bug des sessions!)

index="iso_wa" sourcetype="iso_wa_pages"
| stats values(nv_usr_agt) as nv_usr_agt, values(nv_usr_id) as nv_usr_id, values(nv_cpy_id) as nv_cpy_id by nv_sess_id
| dedup nv_usr_id
| lookup http_user_agent http_user_agent as nv_usr_agt
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| eval browser_name = ua_browser + " " + ua_version
| eval browser_name = if(isnull(browser_name), "Unknown browser", browser_name)
| table browser_name, USER_NAME, COMPANY_NAME
| sort COMPANY_NAME, USER_NAME


-- Browsers utilisés par les clients (avec Id de session calculé)
index="iso_wa" sourcetype="iso_wa_pages"
| lookup http_user_agent http_user_agent as nv_usr_agt
| eval browser_name = ua_browser + " " + ua_version
| eval browser_name = if(isnull(browser_name), "Unknown browser", browser_name)
| eval ced_session_id = nv_sess_id + "__" + nv_usr_id + "__" + nv_cpy_id + "__" + browser_name
| stats values(browser_name) as browser_name, values(nv_usr_id) as nv_usr_id, values(nv_cpy_id) as nv_cpy_id by ced_session_id
| dedup nv_usr_id browser_name
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| table browser_name, USER_NAME, COMPANY_NAME, ced_session_id
| sort COMPANY_NAME, USER_NAME


------- Vérifier ce qu'un utilisateur a fait pendant une certaine période

index="iso_wa" sourcetype="iso_wa_pages"
| search nv_usr_id = 74380
| transaction nv_sess_id
| lookup iso_db_user USER_ID as nv_usr_id
| table _time, nv_pg_tit, USER_NAME
| sort _time
| streamstats count as row
| fields row *


-- Ou bien...
index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_user USER_ID as nv_usr_id
| search USER_NAME="toto"
| table _time, nv_pg_tit, USER_NAME
| sort _time


------- Nombre de NOUVELLES connexions (Logins) pendant une certaine période

index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_visited = 1
| stats count


------- Nombre de connections EXISTANTES

index="iso_wa" sourcetype="iso_wa_pages"
| dedup nv_sess_id
| bucket _time span=1h 
| stats count by _time

-- Ou mieux
index="iso_wa" sourcetype="iso_wa_pages"
| dedup nv_sess_id
| timechart span=1h count


------- Vue historique des pages visitées

index="iso_wa" sourcetype="iso_wa_pages"
| timechart count by nv_pg_tit
| addtotals


-- EXTREME: la liste des utilisateurs qui étaient connectés jusqu'à 120 secondes avant l'erreur!
index="iso_wa" sourcetype="iso_wa_pages" [search index=iso_it sourcetype=iso_it_sysout "Caused by: java.lang.OutOfMemoryError: Java heap space"
| eval earliest=_time-120
| eval latest=_time
| fields + earliest latest
| FORMAT "(" "(" "" ")" "OR" ")"]
| dedup nv_usr_id
| lookup iso_db_user USER_ID as nv_usr_id
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| table COMPANY_NAME, USER_NAME
| sort COMPANY_NAME, USER_NAME


------- Tous (ou un sous-ensemble) des users connectés triés par heure...

index="iso_wa" sourcetype="iso_wa_pages"				-- (nv_usr_id=1 OR nv_usr_id=22 OR nv_usr_id=23 OR nv_usr_id=41 OR nv_usr_id=44)
| timechart span="1h" dc(nv_sess_id) as "Logins"


-- Seulement les Logins, sous forme de table
index="iso_wa" sourcetype="iso_wa_pages" nv_pg_visited=1		-- (nv_usr_id=1 OR nv_usr_id=22 OR nv_usr_id=23 OR nv_usr_id=41 OR nv_usr_id=44)
| lookup iso_db_user USER_ID as nv_usr_id
| table _time, USER_NAME, nv_sess_id
| sort _time


-- Tous les logins de Support Users ISO triés par heure (qui se sont connectés à au moins 2 Companies)
index="iso_wa" sourcetype="iso_wa_pages"
| dedup nv_sess_id, nv_usr_id, nv_cpy_id
| stats first(_time) as "_time", values(nv_usr_id) as "User", values(nv_cpy_id) as "Company", count(nv_cpy_id) as "counter" by nv_sess_id
| where counter > 1
| timechart span="1h" dc(nv_sess_id) as "Logins"


-- Support Users connectés (qui se sont connectés à au moins 2 Companies)
index="iso_wa" sourcetype=iso_wa_pages
| dedup nv_sess_id, nv_usr_id, nv_cpy_id
| lookup iso_db_user USER_ID as nv_usr_id
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| stats values(USER_NAME) as "User", values(COMPANY_NAME) as "Company", count(COMPANY_NAME) as "counter" by nv_sess_id
| where counter > 1


------- (C. Cocquet) Average session duration (in minutes) in ISO 

index=iso_wa sourcetype=iso_wa_pages nv_sess_ms="*"
| stats max(nv_sess_ms) as nv_sess_ms by nv_sess_id, _time
| eval nv_sess_min=nv_sess_ms/1000/60
| timechart avg(nv_sess_min) span=1h


------- (C. Cocquet) Number of distinct logins per day

index=iso_wa sourcetype=iso_wa_pages nv_sess_id="*"
| bin _time span=1d
| timechart dc(nv_sess_id) as logins


------- (C. Cocquet) The graph shows the number of concurrent sessions

index=iso_wa sourcetype=iso_wa_pages nv_sess_ms="*"
| stats max(nv_sess_ms) as nv_sess_ms by nv_sess_id, _time
| eval nv_sess_min=nv_sess_ms/1000/60
| concurrency start=_time duration=nv_sess_min
| timechart max(concurrency) as concurrent_sessions span=1h


------- (C. Cocquet) Graph containing the concurrent sessions, the number of logins and the average session duration

index=iso_wa sourcetype=iso_wa_pages nv_sess_ms="*"
| stats max(nv_sess_ms) as nv_sess_ms, max(_time) as _time by nv_sess_id
| eval nv_sess_sec=nv_sess_ms/1000
| eval nv_sess_min=nv_sess_sec/60
| concurrency start=_time duration=nv_sess_sec
| append [search index=iso_wa sourcetype=iso_wa_pages nv_pg_visited=1 
	| eval event="Login" 
	| stats values(nv_sess_id) as nv_sess_id, values(event) as event by _time]
| timechart max(concurrency) as concurrent_sessions, count(event) as logins, avg(nv_sess_min) as average_session_duration_min span=10m


------- Retrouver la dernière page visitée d'une session

index="iso_wa" sourcetype="iso_wa_pages" nv_sess_id=vYfGew7lOrLeA4V7mV3MvAN
| streamstats max(nv_pg_visited) as maximum
| where nv_pg_visited = maximum
| table nv_sess_id, nv_pg_tit, nv_pg_visited
| sort nv_pg_visited


------- Stats sur l'utilisation de l'Online Inquiry

index="iso_wa" sourcetype="iso_wa_pages" nv_pg_tit="Inquiry - Cash" OR nv_pg_tit="Inquiry - Securities Balances"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| stats count(eval(nv_pg_tit="Inquiry - Cash")) as "Inquiry - Cash", count(eval(nv_pg_tit="Inquiry - Securities Balances")) as "Inquiry - Securities Balances" by COMPANY_NAME
| sort COMPANY_NAME



	Reports (& Viewer & AutoConnect)
----------------------------------------

------- Nombre de rapports générés via le Viewer

index="iso_wa" sourcetype="iso_wa_viewer"
| bucket _time span=1h 
| stats count by _time


------- Top 15 des rapports le plus souvent lancés sur le Viewer

index="iso_wa" sourcetype="iso_wa_viewer"
| stats count as "# run" by rv_rpt_name
| sort -"# run"
| head 15


------- Téléchargements AutoConnect

index="iso_wa" sourcetype="iso_wa_reports" rpt_deliv_type="AUTO_CONNECT"
| lookup iso_db_user USER_ID as usr_id
| lookup iso_db_company COMPANY_ID as cpy_id
| table _time, USER_NAME, COMPANY_NAME, rpt_name
| rename USER_NAME as "User ID", COMPANY_NAME as "Company ID", rpt_name as "Report Name"


------- Vérifier si des rapports sont toujours utilisés

index="iso_wa" sourcetype="iso_wa_reports" rpt_name="Account Group Audit Report (Internal)" OR rpt_name="User Account Access Audit Report (Internal)" OR rpt_name="User Permission Audit Report (Internal)" OR rpt_name="User Profile and Permissions Report (Internal)"
| sort _time


------- Volume d'utilisation des rapports

-- SIR
index="iso_wa" sourcetype="iso_wa_reports"
| search rpt_sir_type = "STANDARD_INTERACTIVE" OR rpt_sir_type = "DATA_EXTRACT"
| timechart span="1d" count by rpt_sir_type

-- Reports SIR par Report Type et Company Type
index="iso_wa" sourcetype="iso_wa_reports"
| lookup iso_db_company COMPANY_ID as cpy_id
| search rpt_sir_type = "STANDARD_INTERACTIVE" OR rpt_sir_type = "DATA_EXTRACT"
| search SERVICE_COMPANY=*
| table _time, rpt_sir_type, SERVICE_COMPANY
| eval ced = rpt_sir_type + " - " + SERVICE_COMPANY
| timechart span="1d" count by ced


-- PGR (bof-bof!!)
index="iso_wa" sourcetype="iso_wa_pages" nv_pg_tit="*Pre-Generated Report*"
| timechart span="1d" count


------- EXTREME: "pivot table" des rapports GC "2xx" et "3xx" avec les Company en lignes, les rapports en colonnes, et le nombre de générations dans les cellules

index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| eval productId = coalesce(product_id, rv_product_id)
| search rpt_sir_type = "STANDARD_INTERACTIVE"
| search productId = 3
| search reportName = "2*" OR reportName = "3*"
| lookup iso_db_company COMPANY_ID as companyId
| chart limit=100 count over COMPANY_NAME by reportName


------- Qui a lancé les rapports 455/455A?

index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| eval logName = coalesce(log_name, rv_log_name)
| search reportName = "455*"
| lookup iso_db_company COMPANY_ID as companyId
| table _time, reportName, logName, is_supt , COMPANY_NAME, sourcetype
| rename reportName as "Report", logName as "User", is_supt as "Support", COMPANY_NAME as "Company"
| sort _time


------- Split des générations de rapports par Report Source

index="iso_wa" sourcetype="iso_wa_reports"
| timechart span="1d" count by rpt_src


------- Stats de générations de rapports par Company

index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| eval reportSource = coalesce(rpt_src, rv_rpt_src)
| eval delivery = if(isnull(rpt_deliv_type), "Viewer", rpt_deliv_type)
| lookup iso_db_company COMPANY_ID as companyId
| eval COMPANY_NAME = replace(COMPANY_NAME, ",", "")
| stats count values(SERVICE_COMPANY) as CompanySource, values(delivery) as DeliveryType, values(reportSource) as ReportSource, values(rpt_sir_type) as ReportSIRType by reportName, COMPANY_NAME
| table COMPANY_NAME, CompanySource, reportName, ReportSource, ReportSIRType, DeliveryType, count
| sort COMPANY_NAME, reportName


------- Utilisation de rapports PGR pour des Companies particulières

index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval source = coalesce(rpt_src, rv_rpt_src)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| lookup iso_db_company COMPANY_ID as companyId
| search COMPANY_NAME = "Vontobel Asset Management S.A." OR COMPANY_NAME = "BANK VONTOBEL AG"
| search source = "TRUST_PGR" OR source = "DFS_ONLINE_PGR" OR source = "TRUST_TRUST_STMT" OR source = "TRUST_TAX"
| dedup COMPANY_NAME, reportName, source
| table COMPANY_NAME, reportName, source
| sort COMPANY_NAME, reportName


------- Volume de consultation de rapports

-- Quel jour y a-t-il le plus de consultations?
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| timechart span=1d count 
| eval weekday=strftime(_time,"%A") 
| stats avg(count) by weekday
| sort -avg(count)

-- A quelle heure y a-t-il le plus de consultations?
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| timechart span=1h count 
| eval hour=strftime(_time,"%H") 
| stats avg(count) by hour
| sort -avg(count)


------- Nombre de "Create" ou "Modify" User par mois

index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_tit = "*Edit User*" OR nv_pg_tit = "*Create New User*"
| timechart span="1month" count by nv_pg_tit



	Transactions
--------------------

------- Détails des Security Purchase/Sales d'un client particulier

index="iso_wa" sourcetype="iso_wa_transactions"
| search tr_user_name="*@waverton.co.uk"
| search tr_type="PURCHASE_GC"
| table _time, tr_type, tr_category, tr_account, tr_backend, tr_settlement_amount
| sort _time


------- # de saisies de transactions + nbre de fichiers chargés par jour (BANK)

index="iso_wa" sourcetype="iso_wa_transactions"
| search tr_backend ="FOCUS"
| timechart span="1d" count

index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| search SERVICE_COMPANY = "Bank and Trust" OR SERVICE_COMPANY = "Bank"
| search nv_pg_tit = "Transaction Upload"
| timechart span="1d" count


	Database
----------------

------- Retrouver des IDs dans la base de données

-- Pour une Company
| inputlookup iso_db_company
| search COMPANY_NAME = "*Danske*"
| table COMPANY_ID COMPANY_NAME


-- Pour un User
| inputlookup iso_db_user
| search USER_NAME = "vanh.diep@wh-ireland.co.uk"
| table USER_ID USER_NAME



	Divers
--------------

------- Mediolanum Queries...

-- How many times Mediolanum users log on
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_log_name=*mediolanum* nv_pg_visited=1
| timechart span=1w count

-- How many Mediolanum users log on
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_log_name=*mediolanum* nv_pg_visited=1
| stats count by nv_log_name
| sort count

-- What page they visit
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_log_name=*mediolanum*
| stats count by nv_pg_tit
| sort -count

-- If they are downloading reports
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| eval delivery = if(isnull(rpt_deliv_type), "Viewer", rpt_deliv_type)
| lookup iso_db_company COMPANY_ID as companyId
| search COMPANY_NAME = "*Mediolanum*"
| dedup COMPANY_NAME, reportName
| table COMPANY_NAME, reportName, delivery
| sort COMPANY_NAME, reportName, delivery

-- How often these reports were accessed?
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| search companyId = 853 OR companyId = 2575 OR companyId = 2648
| stats count by reportName


------- André Peeters Queries...

-- 1
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_visited = 1
| timechart span=1mon count

-- 2
index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| search nv_pg_visited = 1
| stats count by COMPANY_NAME
| sort -count

-- 3
index="iso_wa" sourcetype="iso_wa_pages"
| stats count by nv_pg_tit
| sort -count

-- 4
index="iso_wa" sourcetype="iso_wa_pages"
| lookup iso_db_company COMPANY_ID as nv_cpy_id
| chart count over nv_pg_tit by SERVICE_COMPANY
| head 10

-- 5
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_visited = 1
| stats count as "Connexions" by nv_cpy_id
| bucket Connexions span=1000
| stats count by Connexions

-- 5
index="iso_wa" sourcetype="iso_wa_reports"
| search rpt_sir_type NOT NULL
| timechart span="1month" count by rpt_sir_type

-- 6
index="iso_wa" sourcetype="iso_wa_reports"
| timechart span="1month" count by rpt_src

-- 7
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval reportName = coalesce(rpt_name, rv_rpt_name)
| stats count by reportName
| sort -count

-- 8
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval companyId = coalesce(cpy_id, rv_cpy_id)
| lookup iso_db_company COMPANY_ID as companyId
| stats count by COMPANY_NAME
| sort -count

-- 9
index="iso_wa" sourcetype="iso_wa_transactions"
| search tr_backend NOT NULL
| timechart span="1month" count by tr_backend

-- 10
index="iso_wa" sourcetype="iso_wa_reports" OR sourcetype="iso_wa_viewer"
| eval product = coalesce(product_id, rv_product_id)
| bucket _time span="1month"
| stats count(eval(product ="1")) as "Investment Analytics", count(eval(product ="2")) as "Benefit Payments", count(eval(product ="3")) as "Global custody", count(eval(product ="4")) as "Securities Lending", count(eval(product ="6")) as "Fund Administration", count(eval(product ="8")) as "Alternative investments", count(eval(product ="9")) as "Administrative", count(eval(product ="10")) as "Shareholder Services", count(eval(product ="10")) as "Investment Counsellor Services", count(eval(product ="10")) as "Administration" by _time


------- ISO Refactoring Queries...

--
-- GENERAL STATS
--

-- # of logins (per week)
index="iso_wa" sourcetype="iso_wa_pages"
| timechart span="1w" dc(nv_sess_id) as "Logins"

-- Most visited pages (Top 30)
index="iso_wa" sourcetype="iso_wa_pages"
| stats values(nv_url) as URL, count by nv_pg_tit
| sort -count
| head 30

-- Average session duration (per day)
index=iso_wa sourcetype=iso_wa_pages nv_sess_ms="*"
| stats max(nv_sess_ms) as nv_sess_ms by nv_sess_id, _time
| eval nv_sess_min=nv_sess_ms/1000/60
| timechart avg(nv_sess_min) span=1d

-- Average page generation time (per title - top 30 - Excluding ICS)
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_tit NOT "Package Summary *"
| stats values(nv_url) as URL, avg(nv_load_time) as load by nv_pg_tit
| eval load=load/1000/60
| sort load desc
| head 20

--
-- REPORTS STATS
--

-- # of visualized reports (per week)
index="iso_wa" sourcetype="iso_wa_reports"
| timechart span="1w" count

-- # of reports displayed by the viewer (per week)
index="iso_wa" sourcetype="iso_wa_viewer"
| bucket _time span=1w
| stats count by _time

-- # of AutoConnect downloads (per week)
index="iso_wa" sourcetype="iso_wa_reports" rpt_deliv_type="AUTO_CONNECT"
| bucket _time span=1w
| stats count by _time

--
-- TRANSACTIONS STATS
--

-- # of created transactions (per week)
index="iso_wa" sourcetype="iso_wa_transactions"
| search tr_status = "ENTERED"
| search tr_backend NOT "NULL"
| timechart span="1w" count by tr_backend

-- # of File Uploads (per week)
index="iso_wa" sourcetype="iso_wa_pages"
| search nv_pg_tit = "Transaction Upload"
| timechart span="1w" count by nv_pg_tit, nv_url



	* Développements ********************************************************************************************************
*********************************************************************************************************************************

	DEV Environment
-----------------------

	Console d'admin (Nouveau DEV)
https://ulvzxnad0004.devfg.rbc.com:9043/ibm/console

	Nouveau ISO DEV
https://ulvzxnad0004.devfg.rbc.com/rdis/Login.html?lang=en

	Nouveau ISO QA
https://qa-intonline.saifg.rbc.com/rdis/Login.external 
	ST_Admin6
	Password1 

	Putty (Q Id)
ulvzxnad0004.devfg.rbc.com

Devenir root:
	sudo su -

Lancer le DMGR:
	sudo -u wasadmin /usr/was85/profiles/dmgr/bin/startManager.sh

Lancer le Node:
	sudo su - wasadmin /usr/was8/profiles/appsrv/bin/startNode.sh


------- Ikeyman

	Tuto
https://aruljohn.com/info/x11forwarding/
https://community.hpe.com/t5/General/Can-t-connect-to-X11-window-server-using-localhost-0-0-lt-lt-lt/td-p/4218005

In Windows, look for the shortcut to start Xming. Right click your mouse to go to properties.
add -ac to your XMing shortcut:
	C:\localapp\Specifics\Applications\Xming\Xming.exe :0 -clipboard -multiwindow -ac
The -ac parameter allows everyone to connect.

Lancer Xming
	-> View logs
	(10.80.23.65)

Connexion à "ulvzxnad0004.devfg.rbc.com" avec Putty:
	export DISPLAY=10.80.23.65:0.0
	cd /opt/was85/java_1.8_64/jre/bin
	./ikeyman

...

Connection à "ulvzxnad0004.devfg.rbc.com"
-> Q ID

sudo su - pzxn0ap1

cd /app/zxn0/
mkdir keystore
[mkdir keystore2]

sudo su -

cd /app/http85/bin
./ikeyman

-- Création de la clé du serveur (fichiers KDB, RDB, STH)
	Key Database File -> New
		Key database type: CMS
		File Name: ulvzxnad0004_key.kdb
		Location: /app/zxn0/keystore

		Password: Dardino00
		[v] Stach the passwd into the file

-> 3 fichiers sont créés (/app/zxn0/keystore/):
	*.kdb
	*.rdb
	*.sth
Changer les permissions des fichiers en read pour tout le monde
	chmod ugo+r *

-- Création du Self-Signed Certificate dans le keystore:
[PERSONAL CERTIFICATES]
-> Create
	New Key and Certificate Request

	Key Label:		webserver_new
	Key Size:		2048
	Signature Algorithm:	SHA256WithRSA
	...
	Email Address:		ITWEB@rbc.com
	Name:			ulvzxnad0004_new.arm

Copier les infos du certificat SSL (Subject)

?? retrouver le nom du fichier KDB
	cat /app/http85/conf/app_ssl.conf/

[
Exporter le certificat (fichier ARM):
	Extract Certificate...
	Data type:  Base64-encoded ASCII data
	Certificate file name: ulvzxnad0004_cert3.arm
	Location: /app/zxn0/keystore
]

Formulaire de demande d'un certificat SSL:
https://webapps4.fg.rbc.com/WLM0/Forms/SSLCertReqMain.aspx
	Request Type: NEW
	
	App Code: ZXN0
	Environment: TEST
	Certificate Usage: RBC_EXTERNAL
	Certificate Type: Standard SHA 2
	Certificate Life: 3 Years
	
	Server Name(s): ulvzxnad0004
	Number of Servers: 1
	Server Platform: WebSphere
	
	Browse to your CSR file: Fichier _ARM_
	
	Enter Subject Alternate Names: ulvzxnad0004.devfg.rbc.com
	Enter a Generic Mailbox: ITWEB@rbc.com

Puis télécharger le nouveau certificat depuis la même application sur le serveur
	https://webapps4.fg.rbc.com/WLM0/Forms/RequestDownload.aspx?ctn=26383
	-> ulvzxnad0004.devfg.rbc.com.cer

Et l'importer dans le KeyStore
	sudo su -
	cd /app/http85/bin
	./ikeyman
Open:
	CMS
	ulvzxnad0004_key.kdb
	/app/zxn0/keystore

[Personal Certificates]
	Reveive
		*.cer

[Signer Certificates]
	Add...
		*.cer
	Populate...
		[Select all!]

https://ulvzxnad0004.devfg.rbc.com:9043/ibm/console
Servers -> Server Types -> Web servers

	CONFIG HTTP
cd /opt/http85/conf
Modifier app_ssl.conf
	KeyFile "/opt/http85/keys/zxn0key.kdb"
	SSLStashFile "/opt/http85/keys/zxn0key.sth"

	LOGS HTTP
cd /app/zxn0/logs/ihs/

	APACHE
cd /opt/http85/bin
./apachectl -k stop
./apachectl -k start

	WEB
https://ulvzxnad0004.devfg.rbc.com:443/index.html

KeyFile "/opt/http85/keys/zxn0key.kdb"
SSLStashFile "/opt/http85/keys/zxn0key.sth"

...



	POC - ISO Framework Migration
-------------------------------------

------- Liens

	RBC One Bookmarks
https://rbcgithub.fg.rbc.com/pages/u0r0-REG/rbcone-registry-bookmarks/#/

	RBC One Catalogue de Widgets
https://rbcgithub.fg.rbc.com/pages/U0R0-UI/rbcone-catalog/#/catalog/inputs

	Spring Guides
https://spring.io/guides

	Exemples
https://rbcgithub.fg.rbc.com/u0r0-REG/rbcone-registry-multipurpose-service/blob/master/src/main/java/com/rbc/one/registry/multipurpose/rest/MultiPurposeRestController.java
https://rbcgithub.fg.rbc.com/u0r0-REG/rbcone-registry-ui/tree/develop/src/app


------- Installation & création du projet

	Télécharger Python
https://www.python.org/downloads/release/python-2714/

L'installer sous:
	P:\Tools\Python27\

Ajouter la variable d'environnement:
	python		P:\Tools\Python27\python.exe

	Télécharger Node.js
https://nodejs.org/en/

L'installer sous:
	P:\Tools\nodejs\

Test:
	node -v

Editer "P:\Tools\nodejs\node_modules\npm\npmrc" avec:
	registry=http://rbconenexus.fg.rbc.com:8081/repository/u0r0-npm-group
	phantomjs_cdnurl=http://rbconenexus.fg.rbc.com:8081/repository/phantomjs
	ca=
	strict-ssl=false
	always-auth=false

Installer Angular CLI:
	npm install @angular/cli -g

Test:
	ng -v

Créer un nouveau projet:
	cd P:\Workspaces
	ng new POC --routing

Démarrer la mert:
	ng serve

Dans un Browser:
	http://localhost:4200/


------- ToDo

	TEST Application
	----------------

---> GREETING

	WS Spring
P:\Workspaces\workspace-sts-3.9.2.RELEASE

Build Maven:
	Clic droit sur le POM.xml -> Run As... -> Maven Build...
		Goals: install
		[v] Skit Tests

Lancer le serveur dans SPS:
	Click droit sur "Application.java" -> Run As -> Java Application

Dans un Browser:
	http://localhost:8080/greeting


---> CURRENCIES

	WS Angular
P:\Workspaces\POC2\


	REAL POC
	--------

http://localhost:8080/RDISinvestor/secure/admin/EnterpriseAdministration.direct?component=pollerStatusLink
	-> System Administration -> Poller Status

	Spring Workspace
P:\Workspaces\spring ws\

	Angular Workspace
P:\Workspaces\spring ws\iso-admin

	Oracle
config_rdis
config_poller
config_communication


------- Fersion vinale

	Récupération du projet
cd P:\Workspaces\POC3
git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/POC.git

En cas de problème avec le build du projet dans Eclipse, il faut ré-installer un module Angular:
	cd P:\Workspaces\POC3\POC\iso-administration-service\src\main\angular
	npm install @ngx-translate/core --save
	npm install @ngx-translate/http-loader

Et s'assurer que le bon JDK est utilisé avant le Run de Maven:
	JDK1.8_u151

Pour un build en ligne de commande, il faut changer la variable JAVA_HOME pour pointer vers un JDK 1.8!

Il faut aussi choisir l'environnement cible dans le POM.xml:
	<argument>--environment=local</argument>
	<argument>--environment=dev</argument>
	<argument>--environment=qa</argument>
	<argument>--environment=prod</argument>

Pour lancer l'application, il faut sélectionner le profile "local" dans les "Run Configurations..." puis "Spring Boot Application"!
	P:\Workspaces\POC3\POC\iso-administration-service\src\main\java\com\rbc\rdis\investor\Application.java

Il est nécessaire de placer un dummy Token dans la base de données (qui pointe vers un User Perm Context valide):
	INSERT INTO SSO_TOKEN (TOKEN_VALUE,EXPIRY_DATE,USER_ID,SSO_SYSTEM,COMPANY_ID,USER_PERM_CTXT_ID,DOMAIN_NAME)
	VALUES ('1', sysdate+1000, 0, 'WORKSPACE_MGR', 0, 1, null);

URL de l'appli:
	http://localhost:8081/index.html?token=1#/poller/configuration


------- En cours...

	Tutoriels
https://angular.io/guide/architecture
https://fr.wikipedia.org/wiki/TypeScript

	Astuces Visual Studio Code...
https://code.visualstudio.com/docs/getstarted/tips-and-tricks
https://www.developpez.com/actu/191936/Visual-Studio-Code-1-21-est-disponible-quelles-sont-les-nouveautes-dans-l-editeur-de-code-open-source-et-multiplateforme-de-Microsoft/

	Liens intéressants
https://www.javacodegeeks.com/2018/03/spring-boot-angular-5-spring-data-rest-example-crud.html
https://www.javacodegeeks.com/2018/03/angular5-jwt-authentication-spring-boot-security.html

	Traductions
https://github.com/ngx-translate/core
https://medium.com/letsboot/translate-angular-4-apps-with-ngx-translate-83302fb6c10d

...



	MIFID
-------------

-> Nouveaux flux de rapports pour MIFID à implémenter.


------- Accès

LOCAL
	audrey.parker@id4.somewhere.com
	Password9
	Company: Axa Canada
	Role: x3


------- Base de données

-- Product
--
SELECT *
FROM product_vf
WHERE permission_id LIKE '%moneyMarketFundsRpt%'
;

-- Menu
--
SELECT *
FROM rpt_navigation_node
WHERE description LIKE '%Money Market Funds%'
;

-- Permission
--
SELECT *
FROM permission
WHERE permission_id LIKE '%moneyMarketFundsRpt%'
;

-- Node-Permission
--
SELECT *
FROM rpt_navigation_node_perm
WHERE rpt_navigation_node_id = 'secServ.moneyMarketFunds'
;

-- CIA Profiles & Accounts
--
SELECT *
FROM parameter_lookup_cache
WHERE qualifier IN ('CIA_PROFILES', 'CIA_ACCOUNTS')
;

-- CIA's assigned to a company
--
SELECT company_id, lookup_key
FROM cia_company CC, parameter_lookup_cache PLC
WHERE CC.cia_id = PLC.parameter_lookup_cache_id
AND qualifier = 'CIA_PROFILES'
AND company_id = 4
;

-- Utilisation de la nouvelle vue
SELECT company_id,
  report_name,
  currency,
  account_name,
  vf_user_group AS cia_id,
  report_frequency AS account_ref,
  permission_id,
  rpt_navigation_node_id,
  product_id,
  report_source_value
FROM vw_money_market_fund_reports
;

-- Informations de la nouvelle vue complète...
--
SELECT
  CC.company_id,
  VRI.vf_user_group AS CIA_ID,
  VRI.vf_product,
  VRI.rpt_doc_nm,
  VRI.dept_clnt_ref,
  VRI.rpt_doc_crean_dts,
  VRI.rpt_doc_period_to,
  VRI.dept_rpt_ref,
  VRI.rpt_doc_file_ext,
  VRI.trade_currency,
  VRI.rpt_doc_file_size,
  PLC2.value3
FROM vf_report_instance VRI, cia_company CC, parameter_lookup_cache PLC, parameter_lookup_cache PLC2
WHERE VRI.vf_product LIKE '%CIA%'
AND CC.company_id = 4
AND PLC.qualifier = 'CIA_PROFILES'
AND CC.cia_id = PLC.parameter_lookup_cache_id
AND PLC.lookup_key = VRI.vf_user_group
AND PLC2.qualifier = 'CIA_ACCOUNTS'
AND VRI.vf_user_group || '-' || VRI.dept_clnt_ref = PLC2.lookup_key
;

-- Nouvel account
--
INSERT INTO parameter_lookup_cache (PARAMETER_LOOKUP_CACHE_ID,LOOKUP_SOURCE,QUALIFIER,LOOKUP_KEY,VALUE1,VALUE2,VALUE3,VALUE4) VALUES (
	parameter_lookup_cache_seq.nextval,
	'ALL',
	'CIA_ACCOUNTS',
	'1-VF1G-128',
	'1',
	'VF1G-128',
	'Account (VF1G-128)',
	'USD'
);

-- Nouvelle instance de rapport
--
INSERT INTO vf_report_instance (
	VF_REPORT_INSTANCE_ID,
	RPT_DOC_ID,
	CD_RPT_DOCVFFILE_TP,
	DEPT_RPT_REF,
	RPT_DOC_CREAN_DTS,
	RPT_DOC_FILE_EXT,
	RPT_DOC_FILE_NM,
	RPT_DOC_FILE_SIZE,
	RPT_DOC_NM,
	RPT_DOC_PERIOD_TO,
	VF_USER_GROUP,
	VF_PRODUCT,
	DEPT_CLNT_REF,
	CD_RPT_DOC_VF_CTG,
	SYS_CREAN_DT,
	TRADE_CURRENCY
) VALUES (
	vf_report_instance_seq.nextval,
	'3000',
	'PDF',
	'VF1G-128',		--> Account Num
	to_timestamp('01/01/18 07:29:45,000000000','DD/MM/RR HH24:MI:SSXFF'),
	'PDF',
	'001',
	'34',
	'RETIREMENT PLAN',	--> Report Name
	to_timestamp('02/02/18 00:00:00,000000000','DD/MM/RR HH24:MI:SSXFF'),
	'1',			--> CIA Profile
	'CIA',			--> VF Product
	'00000000',		--> Account #
	'001',
	to_timestamp('03/03/18 07:29:45,000000000','DD/MM/RR HH24:MI:SSXFF'),
	'EUR'
);


-- Nouveaux liens CIA - Company
--
INSERT INTO cia_company(id, cia_id, company_id) VALUES(CIA_COMPANY_SEQ.nextval, 1, 4);
INSERT INTO cia_company(id, cia_id, company_id) VALUES(CIA_COMPANY_SEQ.nextval, 2, 4);
INSERT INTO cia_company(id, cia_id, company_id) VALUES(CIA_COMPANY_SEQ.nextval, 3, 4);


------- Développements

- Nouvelles permissions (Company Level) - SQL
	products.trust.secServ.moneyMarketFundsRpt
	products.bank.secServ.moneyMarketFundsRpt

- Nouveau Menu - SQL
	Money Market Funds: secServ.moneyMarketFunds

- Alignement des 2 permissions en JS:
	EditPermissionTree.script
	EditPermissionTreeComponent.java

- Autres fichiers modifiés
	RDOBase
		RDISreportCommon/src/main/resources/applicationContext-reportBean.xml
		RDISinvestorCommon/src/main/resources/common.hibernate.cfg.xml
		RDISinvestorRemoteCommon/src/main/java/com/rbcdexia_is/rdis/model/enumeration/ReportSource.java
		RDISmodel/src/main/java/com/rbcdexia_is/rdis/common/types/ReportTypeEnum.java
		RDISmodel/src/main/java/com/rbcdexia_is/rdis/investor/model/ProductVFEnum.java
		RDISmodel/src/main/java/com/rbcdexia_is/rdis/investor/model/reports/ReportNavigationNode.java
		RDISreportCommon/src/main/java/com/rbcdexia_is/rdis/investor/bean/report/ReportEventSubscriptionDisplay.java
		RDISreportCommon/src/main/java/com/rbcdexia_is/rdis/investor/dao/impl/BundleDAOImpl.java
		RDISreportCommon/src/main/java/com/rbcdexia_is/rdis/investor/dao/impl/ReportDAOImpl.java
		RDISreportCommon/src/main/java/com/rbcdexia_is/rdis/investor/model/reports/AbstractCompanyReport.java
		RDISreportCommon/src/main/resources/report.hibernate.cfg.xml
		RDISinvestorCommon/src/test/resources/database/rdis/major_rev_0053/revision0001.sql
		RDISreportCommon/src/main/java/com/rbcdexia_is/rdis/investor/model/reports/MoneyMarketFundReport.java
	RDOPoller
		RDISinvestorPollers/src/main/java/com/rbcdexia_is/rdis/investor/service/event/AlertCreationServiceImpl.java
	RDOWeb
		RDISinvestor/src/main/java/com/rbcdexia_is/rdis/investor/page/menu/MenuLinkEnum.java
		RDISinvestor/src/main/java/com/rbcdexia_is/rdis/investor/page/secure/reports/ProductReports.java
		RDISinvestor/src/main/resources/RDISinvestor_en.properties
		RDISinvestor/src/main/resources/RDISinvestor_fr.properties
		RDISinvestorServices/src/main/java/com/rbcdexia_is/rdis/investor/service/bundle/BundleServiceImpl.java


------- Divers

...
PreGeneratedReportsVF.getReportListFromService()
BaseReportImpl.findReportsMMF()
...

Après avoir bidouillé dans les permissions:
	Clic droit sur la procédure 'UPDATE_PERMISSION_ANCESTORS' -> Run.

	Donner le droit à une Company depuis: Company Admin -> Permissions -> Edit Company Permissions
http://localhost:8080/RDISinvestor/secure/admin/CompanyAdministration.external

On bidouille le rôle depuis la page d'administration des Users...


------- Todo

	Debugging Eclipse!
https://www.eclipse.org/forums/index.php/t/153106/

...



	POC - ISO WebServices Migration
---------------------------------------

------- PCF

	Installation
https://rbc-confluence.fg.rbc.com:8443/display/CADOP/PCF+-+Onboarding#PCF-Onboarding-OnboardingGuide

	Download Cloud Foundry
https://github.com/cloudfoundry/cli

	Getting Started with the cf CLI
https://docs.run.pivotal.io/cf-cli/getting-started.html#login

	To login via command line:
cf login -a api.sys.pcf.devfg.rbc.com
	Email> 524286135
	Password> [Pine pass]

	The PCF Web Console is:
https://apps.sys.pcf.devfg.rbc.com

By default, config.json is located in your ~/.cf directory:
	C:\Users\524286135\.cf

	List the users who are members of an org:
cf org-users ZXN0

	Liste des applications
cf apps

	Liste des buildpacks
cf buildpacks


------- POC WebService

P:\Workspaces\WebService
Avec Eclipse STS

Générer un nouveau projet depuis:
http://start.spring.io

MAJ préférences Maven...
Et JDK!!

	URL locale:
http://localhost:8080
http://localhost:8080/greeting

	Build
Run As... -> Maven Build...
	clean install
	[v] skip tests

	WAR location
P:\Workspaces\WebService\authentication\authentication\target

	Push
cf push ced-poc-auth -p authentication-0.0.1-SNAPSHOT.war

	Logs
cf logs ced-poc-auth --recent

	URL PCF:
https://ced-poc-auth.apps.pcf.devfg.rbc.com
https://ced-poc-auth.apps.pcf.devfg.rbc.com/greeting

	Create a Oracle User Provided Service
cf create-user-provided-service oracle-ced-service -p '{"uri":"oracle://rzxn0ewf:rzxn0ewf@oc11d0-scan.devfg.rbc.com:1527/dxazd19"}'

	Service credentials
uri: oracle://rzxn0ewf:rzxn0ewf@oc11d0-scan.devfg.rbc.com:1527/dxazd19


------- User Details WebService

Mon workspace:
	P:\Workspaces\to_be_deleted\toto

URL:
	http://localhost:9090/iso/sso/ws/UserDetailsService

WSDL:
	http://localhost:9090/iso/sso/ws/UserDetailsService?wsdl

-- SSO Token
SELECT *
FROM sso_token
;

-- SSO System Information
SELECT *
FROM sso_system_information
;

...


------- User Authentication WebService

	Create a Oracle User Provided Service
cf create-user-provided-service iso-sso-db -p '{"uri":"oracle://rzxn0ewf:rzxn0ewf@oc11d0-scan.devfg.rbc.com:1527/dxazd19"}'

	Push
cf push iso-sso-authentication-srv -p iso-sso-authentication-service-0.0.1-SNAPSHOT.war

	Logs
cf logs iso-sso-authentication-srv --recent

	URL (new)
https://iso-sso-authentication-srv.apps.pcf.devfg.rbc.com/iso/sso/ws/SSOAuthenticationService?wsdl
https://iso-sso-user-details-srv.apps.pcf.devfg.rbc.com/webservices/ISsoUserDetailsWebService?wsdl

	URL (old - QA)
https://qa-online.sterbc.com/rdis/webservices/ISsoAuthenticationWebService?wsdl
https://qa-online.sterbc.com/rdis/webservices/ISsoUserDetailsWebService?wsdl

...


------- En cours...

Liste des Web Services ISO QA:
	https://qa-intonline.saifg.rbc.com/rdis/webservices

WebServices ISO:
	ISsoAuthenticationWebService
	ISsoUserDetailsWebService 

Spring
	<version>1.5.9.RELEASE</version>
	<version>2.0.3.RELEASE</version>

POM.xml -> RDISMessages

Workspace ISO:
	P:\Workspaces\ISO_GIT_4

Démarrer avec profile "local, set:
	-Dspring.profiles.active=local
under program arguments.

Refaire les logs du service!!

...



	Scuba (Transaction Repair UI)
-------------

------- TL;DR

Le projet TROP RIGOLO de milieu d'année...
Avec en Guest Star: Papy casse-couilles. On va se marrer PUTAIN!


------- Accès

	ISO DEV
Bank_CompanyUser
Password2018

	Registry QA
One_200
Registry04

One_B03
ADMINBP_04

	Registry Prod
One_001
Registry25


------- UI build & Run

	Récupération du projet
cd P:\Workspaces\Scuba\
git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/transaction-ui.git
cd transaction-ui
git checkout develop

	Build de l'application
npm install

	Démarrage de l'application
ng serve

	(Démarrage de l'application pour la prod)
ng serve --prod

	(Démarrage de l'application Ahead Of Time)
ng serve --aot true

	Lancer les tests
ng test -sourcemaps=false

	Application URL
http://localhost:4200


------- PCF Build

cd transaction-ui

Changer l'environnement dans (DEV ou QA):
	transaction-ui\src\environments\environment.prod.ts

Build the application:
	ng build --prod --base-href /proxy/repairui/

cd transaction-ui\dist

Create an the empty FILE:
	"Staticfile"

Copy the 'dist' folder to a remote folder on the Toronto VDI...
	cd C:\Temp\dist

Connect to PCF:
	cf login -a api.sys.pcf.devfg.rbc.com
	1. zxn0_dev_int

Push to PCF:
	cf push transaction-ui-dev

Logs:
	cf logs transaction-ui-dev --recent

	URL:
https://ulvzxnad0004.devfg.rbc.com/proxy/repairui/index.html

	ISO:
https://ulvzxnad0004.devfg.rbc.com/rdis/Login.html?lang=en

[Pour le déploiement en QA, il suffit de compresser le répertoire "dist" et le filer à Giam...]


------- Problèmes

	-> error TS2307: Cannot find module 'rxjs-compat/BehaviorSubject'.
npm install rxjs@6 rxjs-compat@6 --save

	-> error no exported member 'OpaqueToken'.
npm i @angular/flex-layout

	-> Problèmes avec NPM:
HTTP_PROXY=http://ek706:Welcome@2018@proxy-web.dexwired.net:8080
HTTPS_PROXY=http://ek706:Welcome@2018@proxy-web.dexwired.net:8080

	-> Downgrade Angular
[Virer les variables d'environnement "HTTPS_PROXY" et "HTTP_PROXY"]
npm uninstall -g angular/cli
npm cache clean --force
[Fermer le terminal]
npm install -g @angular/cli@1.4.10
ng --version

	-> Variables d'environnement à ajouter en cas de soucis
HTTPS_PROXY=http://ek706:[Password]@proxy-web.dexwired.net:8080
HTTP_PROXY=http://ek706:[Password]@proxy-web.dexwired.net:8080

	-> Folders à supprimer (pour éviter le problème de Store):
P:\Workspaces\Scuba\transaction-ui\node_modules\@rbcone\elements\node_modules\@ngrx
P:\Workspaces\Scuba\transaction-ui\node_modules\@rbcone\list\node_modules\@ngrx
P:\Workspaces\Scuba\transaction-ui\node_modules\@rbcone\nav-header\node_modules\@ngrx
P:\Workspaces\Scuba\transaction-ui\node_modules\@rbcone\widgets\node_modules\@ngx-translate


------- Transaction Repair Service (Dim)

	Workspace
P:\Workspaces\Transaction Repair Service

	Git
https://rbcgithub.fg.rbc.com/ZXN0-ISO/TransactionRepairService

	Mertes pour que ça fonctionne...
Ajout de 2 fichiers pour que le bazard compile:
	.classpath
	.project
Build de la mert directement depuis Eclipse, avec un Java 8!
Maven -> Update Dependencies
Ajouter les sources de "gen" dans le Java Build Path du projet!

Build avec Maven (dans Eclipse!)...

Pour générer le JAR, un Maven "clean install" suffit. Il faut récupérer l'archive depuis le répertoire "target":
	TransactionRepairService-0.0.1-SNAPSHOT.jar

	Console PCF
https://apps.sys.pcf.devfg.rbc.com

Connect to PCF:
	cf login -a api.sys.pcf.devfg.rbc.com
	1. zxn0_dev

Push to PCF:
	cf push transaction-repair-service -p TransactionRepairService-0.0.1-SNAPSHOT.jar

	SharePoint
https://rbcwss.fg.rbc.com/ykl0/X01_IT-WEB/Shared%20Documents/Forms/WEB%20Shared%20Documents.aspx?RootFolder=%2fykl0%2fX01_IT-WEB%2fShared%20Documents%2fSCUBA%2fint&FolderCTID=0x012000C57091073BC3C041B41725FEC78447B2


------- Divers

	Workspace
P:\Workspaces\Scuba

Génération de composants:
	cd P:\Workspaces\Scuba\transaction-ui
	ng generate component txn-repair\filter\txn-repair-date-filter --flat
	ng generate component txn-repair\filter\txn-repair-type-filter --flat
	ng generate component txn-repair\filter\txn-repair-status-filter --flat
	ng generate component txn-repair\filter\txn-repair-account-filter --flat

	Trello
https://trello.com/b/OxpfBRu1/iso-scuba

	SharePoint
https://rbcwss.fg.rbc.com/ykl0/X01_IT-WEB/Shared%20Documents/Forms/WEB%20Shared%20Documents.aspx?RootFolder=%2Fykl0%2FX01%5FIT%2DWEB%2FShared%20Documents%2FISO%20%2D%20Releases%20Content%2FISO%20V3%2E28%20%2D%20November%202018%20Release%2F02%20%2D%20Business%20Requirements&FolderCTID=0x012000C57091073BC3C041B41725FEC78447B2&View=%7B68A06117%2D7C8B%2D4B70%2D875A%2D70C8D77C164F%7D

	Wiki ISO
https://rbcgithub.fg.rbc.com/ZXN0-ISO/ISO-wiki/wiki
	Wiki ISO Angular
https://rbcgithub.fg.rbc.com/ZXN0-ISO/ISO-wiki/wiki/Angular-configuration

	Github 'Transactions UI'
https://rbcgithub.fg.rbc.com/ZXN0-ISO/transaction-ui

	GitHubs 'Rbc One'
https://rbcgithub.fg.rbc.com/u0r0-REG/
https://rbcgithub.fg.rbc.com/u0r0-UI/
https://rbcgithub.fg.rbc.com/u0r0-POS/

	Configuration NPM:
P:\Users\ek706\AppData\Roaming\npm\node_modules\npm\npmrc

Créer une archive TGZ d'un projet:
	npm pack

	UI Catalog
https://rbcgithub.fg.rbc.com/pages/U0R0-UI/rbcone-catalog/#/catalog/intro
https://rbcgithub.fg.rbc.com/U0R0-UI/rbcone-elements/tree/master/src/elements

	NGX Logger
npm install --save ngx-logger


------- En cours...

	Redux
http://blog.js-republic.com/quand-angular-rencontre-redux/

...



	Scuba (Account Migration)
-------------

------- TL;DR

Il faut pouvoir utiliser les nouveaux accomptes migrés (Milvus) dans les écrans ISO.


------- Accès

Local:
	audrey.parker@id4.somewhere.com
Dev:
	scubidou@scuba.com


------- Modifications ISO

	SIR - All Applicable Accounts
	-----------------------------

TrustAccountHandler.java

-> Must be in the included all the Trust Accounts allocated to the internal role and which have the report permission (ASIS) but also all Migrated Bank Accounts (TO BE).

ReportGeneratorServiceImpl.generateInteractiveReportParameters()
-> TrustAccountHandler.getAccounts()
-> AccountServiceImpl.findMigratedMilvusAccounts(...)
-> AccountDAOImpl.findMigratedMilvusAccounts()


	SIR - Select Accounts
	---------------------

SelectAccounts.java

-> If client has migrated account, migrated bank accounts is displayed in Account Number column and attributed Milvus Account is displayed in Reference Account Number.
-> For research on Account Number, migrated account numbers can also be used to retrieve the record.
-> Ensure that for favourites similar information is stored (trust accounts) and that permission checks are still working.
-> Ensure to send always trust account reference.

SelectAccount:
	BaseSelectReportAccounts.doSearch() 
	-> ... 
	-> ReportAccountServiceImpl.findAccountsForProductNG() 
	-> ReportAccountDAOImpl.findCompanyAccountsForProductReportNG()
	-> CompanyAccountsForProductReportNGHQLStrategy.CompanyAccountsForProductReportNGHQLStrategy()


	SIR - Select Account Groups
	---------------------------

SelectAccountGroups.java

-> All Account Groups with at least one migrated account should be also displayed in the list. In case the Account Group is composed of Bank account and Migrated Bank Account, in the request to report services, only the Migrated Bank Account will be sent.

SelectAccountGroups:
	SelectAccountGroups.doSearch()
	-> SelectAccountGroups.getListFromService()
	-> AccountServiceImpl.findAccessibleUserAccountGroupDisplays()
	-> AccountDAOImpl.findAccessibleUserAccountGroups()

--> Rajout d'une jointure sur les AccountGroups contenant des comptes migrés dans 'AccountDAOImpl.findAccessibleUserAccountGroups()'
--> Utilisation du nouveau champs de Account au lieu de celui de DFS_Account!

	SQL (Modifié)
	---
SELECT distinct AG.*
FROM account_group AG, account_group_account AGA, account A
INNER JOIN account_report_data_source RDS ON A.account_id = RDS.account_id
LEFT OUTER JOIN dfs_account DA on A.account_id = DA.account_id
WHERE AG.company_id = 4
AND AG.account_group_type = 'USER'  
AND AGA.account_group_id = AG.account_group_id 
AND A.account_id = AGA.account_id  
AND RDS.report_data_source_id IN (1, 2, 3, 4, 5, 6, 7)
AND (
	(
		AG.privacy = 'PRIVATE'
		AND AG.user_id = 245
	) 
	OR AG.privacy = 'PUBLIC'
) 
AND (
	(
		AG.is_dfs = 'N'
		AND da.account_id IS NULL
	)
	OR (
		AG.is_dfs = 'Y'
		AND a.ext_ref_account_number IS NOT NULL
	)
);


	SIR - Save as favourite
	-----------------------

AccountServiceImpl.java

-> For any report generated from the Favourite page that is requesting for All Accounts, the request to the backend should also include migrated accounts.This is valid for accounts and group accounts requests.
   The generation of the report will be done thanks to the Milvus reference of Migrated Bank Accounts that will be stored in the EW_Report_Parameter table.

BaseReportParameterValidator.ERROR_EMPTY_ACCOUNT_GROUP
AccountGroupValidator.validate()
AccountGroupValidator.getAccounts()
AccountServiceImpl.findAccountNumbersForUserAccountGroupsAndAccounts()
AccountDAOImpl.findAccountNumbersForUserAndAccountGroups()
[AccountDAOImpl.findAccountNumbersForAccounts()]

	SQL
	---
select *
from vw_report_product_account pra, Account a
INNER JOIN account_report_data_source RDS ON a.account_id = RDS.account_id
where pra.account_id = a.account_id 
and pra.permission_id = 'runnableReport_363'
and pra.product_id = 3 
and a.account_id in ( 
	select aga.account_id 
	from account_group_account aga 
	where aga.account_group_id = 13745
) 
and RDS.report_data_source_id IN (6, 5);

Il faut juste configurer les comptes pour être en Data Source "1".


------- SQL

-- Company (BANK & TRUST)
--
SELECT company_source_name
FROM company
WHERE company_name = 'Axa Canada'
;

-- User
--
SELECT *
FROM rdis_user
WHERE user_name = 'audrey.parker@id4.somewhere.com'
;

-- DFS Account (associated)
-- 100
SELECT *
FROM dfs_account
WHERE element_access_code = 'PA00100'
;

-- Promoter associated to Account "PA00100"
-- PROMOTER_21
SELECT *
FROM dfs_promoter_dfs_account DPDA, dfs_promoter DP
WHERE DPDA.dfs_promoter_id = DP.dfs_promoter_id
AND dfs_account_id = 80
;

-- VF Account (unassociated)
--
SELECT *
FROM vf_account
WHERE account_num = 'VF1G-69'
;

-- Corp ID associated to the account "VF1G-69"
-- VFDEMO1 
SELECT *
FROM vf_company_vf_account VCVA, vf_account VA
WHERE VCVA.vf_account_id = VA.vf_account_id
AND VCVA.vf_account_id = 306
;

-- Account 'RYLUK' (unassociated)
--
SELECT *
FROM account
WHERE account_id = 149
OR account_id = 100
;

-- New association between the Company and its 'special' Corp ID
SELECT *
FROM company_ext_vf_company
;

-- Check that the company has access to the DFS account only!
--
SELECT *
FROM vw_company_account
WHERE company_id = 4
AND (account_number = 'VF1G-69' -- VF account
  OR account_number = 'PA00100' -- DFS account
);

-- Account Group (migrated)
-- 13745
SELECT *
FROM account_group
WHERE description = 'Scouba'
;

-- Retrouver les accounts migrés (Guaille)
--
SELECT da.ACCOUNT_ID as ACCOUNT_ID, da.ext_ref_account_number as ACCOUNT_NUMBER, cevfc.ext_vf_corp_id as CORP_ID, da.ext_ref_branch_code as BRANCH_CODE
FROM DFS_ACCOUNT da, company_ext_vf_company cevfc 
WHERE da.ext_ref_account_number is not null 
AND cevfc.COMPANY_ID = 4
;

--
SELECT DISTINCT *
FROM ACCOUNT_BANK_TO_MILVUS_MAPPING
;

--
SELECT *
FROM RDIS_USER
WHERE user_name = 'scubidou@scuba.com'
;

-- 2391
SELECT *
FROM COMPANY
WHERE COMPANY_ID IN (
  SELECT company_id
  FROM COMPANY_EXT_VF_COMPANY
);

-- Account
-- 25398550
SELECT *
FROM ACCOUNT
WHERE EXT_REF_ACCOUNT_NUMBER IS NOT NULL
AND account_number = 'LU595100'
;

-- VF Account
-- 94519
SELECT *
FROM VF_ACCOUNT
WHERE ACCOUNT_NUM = '000134120USD                       '
OR ACCOUNT_NUM = '000134120CHF                       '
;

--
INSERT INTO ACCOUNT_BANK_TO_MILVUS_MAPPING(ID, BANK_ACCOUNT_ID, MILVUS_ACCOUNT_NUMBER, CORP_ID, COMPANY_ID)
VALUES (account_bank_to_milvus_map_seq.nextval, 25398550, '000134120CHF                       ', 'GAM     ', 2391)
;
INSERT INTO ACCOUNT_BANK_TO_MILVUS_MAPPING(ID, BANK_ACCOUNT_ID, MILVUS_ACCOUNT_NUMBER, CORP_ID, COMPANY_ID)
VALUES (account_bank_to_milvus_map_seq.nextval, 25398550, '000134120USD                       ', 'GAM     ', 2391)
;
INSERT INTO ACCOUNT_BANK_TO_MILVUS_MAPPING(ID, BANK_ACCOUNT_ID, MILVUS_ACCOUNT_NUMBER, CORP_ID, COMPANY_ID)
VALUES (account_bank_to_milvus_map_seq.nextval, 25398550, 'SCUBATST1                          ', 'GAM     ', 2391)
;


------- Divers

Procédure de migration d'un accompte...
	La Company doit être "Bank and Trust"
	Avec un compte BANK permissioné (Internal Role)
	Avec un compte TRUST NON-permissioné
	Le compte doit être configuré en code/branch RYLUK
	Nouvelle colonne "account.ext_ref_account_number" = "vf_account.account_num"
	[Nouvelle colonne "dfs_account.ext_ref_account_number" = "vf_account.account_num"] -> Pour certains écrans...
	Nouvelle colonne "company_ext_vf_company.ext_vf_corp_id" = "vf_account.user_group"
	...

Account BANK permissionné: PA00100
Account TRUST migré: VF1G-69
Account Group migré: Scouba



	Secure Messages (Secure Communications)
-----------------------

------- TL;DR

Migration de la fonctionnalité "Secure messages" de ISO vers une nouvelle solution à base d'Angular et de Micro-Services.

------- Accès

QA:
	CedricEA


------- SQL

-- Message
SELECT *
FROM SECURE_MESSAGE
;

-- Acces
SELECT *
FROM SECURE_MESSAGE_ACCESS
WHERE secure_message_id = 105334
;

-- Attachment
SELECT *
FROM SECURE_MESSAGE_ATTACHMENT
WHERE secure_message_id = 105334
;

-- BLOB
SELECT *
FROM RDIS_BLOB
WHERE blob_id = 1992720
;


------- ISO Legacy

	Existing
SecureMessages.java
SecureMessageServiceImpl.java
SecureMessageDAOImpl.java
ComposeSecureMessage.java

	Database
secure_message
secure_message_access
secure_message_attachment
rdis_blob
VW_SENT_SECURE_MESSAGE
VW_MSG_USERS

	Permissions
communications.secMsgsReceiveOnly
communications.secMsgsSendOnly

...



	Payee Database (Secure Communications)
----------------------

------- TL;DR

Ajout de la possibilité de gérer la liste des ISINs disponibles lors de l'encodage certains types de transactions (Custody -> Cash Instructions -> Customer).


------- Accès

QA:
	SCUBAGMA


------- SQL

-- Table de référence des BICs
SELECT *
FROM BIC_REFERENCE
WHERE bic_code LIKE '%ANTBIT21001%'
;

-- Pour les autres types de codes:
SELECT *
FROM PARAMETER_LOOKUP_CACHE
--WHERE QUALIFIER = 'TRAN_BROKER_CANADIAN_CODE'
--WHERE QUALIFIER = 'TRAN_BROKER_USFEDWIRE'
--WHERE QUALIFIER = 'TRAN_BROKER_SORTCODE'
;

-- View for bic_reference of type BIC
SELECT *
FROM VW_BIC_REF_BIC
WHERE bic_code LIKE '%ANTBIT21001%'
;

-- Parallel access view for bic_reference of type BIC
SELECT *
FROM VW_BIC_REF_BIC_PAR
WHERE bic_code LIKE '%ANTBIT21001%'
;

-- Parallel access view for joining bic_reference pos with country and province_state tables
SELECT *
FROM vw_bic_ref_pos_par
;

-- Transactions sauvées dans ISO
SELECT *
FROM TRANSACTION_SAVED
WHERE transaction_type_enum_name LIKE '%CASH_INSTRUCTION_CUSTOMER_TRANSFER_GC%'
;

-- XML de la transaction (pour retrouver le code utilisé)
SELECT *
FROM RDIS_BLOB
WHERE blob_id = 121353
;


------- Divers

	Richard
Ils veulent un sous-ensemble des BICS disponibles!
Par client ET par compte!
Qu'ils peuvent sélectonner eux-mêmes
Créé à partir de ce que le client a déjà encodé (history)!
Possibilité d'en ajouter lui-même
Dual approval pour tout ce qui est encodé
4 Permissions

	Richard 2
Rien par défaut - 
Pas de nouveau droit pour l'utilisateur, seulement pour l'administrateur
Nouveau moyen pour que les Backends nous envoient l'historique!
Réconcilier les différents types de BICs...
Validation des templates existants! Les BICS non valides doivent être modifiés par l'utilisateur! (Medium requirement)
Nouvel "Accounting Code" dans l'écran! Qui vient d'une table statique.
Bouton de validation/validation en lot
On ne veut PAS d'Unknown!
2 solutions d'Approval vont coexister...

	Legacy code
CreateCashInstructionGC
CashInstructionCustomerTransfer
InstitutionDetails.suggestIdentifier()

Administration des BIC
-> Administration -> System Administration -> Reference Data -> Bank Identifier Codes (BIC)

Questions / remarques:
	Les backends vont vraiment nous fournir la liste des Codes déjà utilisés pour l'initial load?
	C'est quoi, les autres types de codes (Z Code, ...)
	Il me faudrait le User de Richard pour faire des tests!
	...

...



	Transactions 4 Eyes (Secure Communications)
---------------------------

------- TL;DR

Ajout de la possibilité de faire un 4 eyes des certains types transactions encodées (et chiantes à annuler)...


------- Divers

	Screens
Cash instruction
Trade instruction Buy/Sell


Attention au nouvel écran de Transaction Repair!
L'approve own est pris en compte là-dedans...



	CMS
-----------

------- TL;DR

Migration de l'application CMS existante vers Angular.


------- Environment setup (VDI)

	[ISO Wiki]
https://rbcgithub.fg.rbc.com/ZXN0-ISO/ISO-wiki/wiki/EPR-development-environment-installation

	Catalogue d'applications RBC:
http://se115076/CMApplicationCatalog/#/SoftwareCatalog/FullRefresh/true

Installation de "Node.js" depuis le Catalogue RBC.

Configurer Node:
	cd C:\Users\524286135
	echo > .npmrc
Ajouter dans C:\Users\[pine id]\.npmrc
	strict-ssl false
	registry "https://registry.npmjs.org/"

Installation de "Python Version 2.7.11" depuis le Catalogue RBC.

Ajout de Python au Path:
	rundll32 sysdm.cpl,EditEnvironmentVariables
	PYTHON		C:\Python27
	PYTHON2		C:\Python27

Installation de "Visual Studio Code" depuis:
	https://code.visualstudio.com
Sous:
	C:\Users\524286135\AppData\Local\Programs\Microsoft VS Code

Installaiton de "Git" depuis:
	http://git-scm.com/download/win
Sous:
	C:\Users\524286135\AppData\Local\Programs\Git

Select the following installation options:
	Use Git from the Window Command Prompt
	Use the OpenSSL library
	Checkout Windows-style, commit Unix-style line endings
	Use MinTTY (the default terminal of MSYS2)
	Enable file system caching and Enable Git Credential Manager

Copy the following files from the P:\Users\ek706\ folder of the Luxembourg VDI to the C:\Users\524286135\ folder of the Toronto VDI.
	-> ".ssh" folder
	-> ".gitconfig" file

Installer Angular:
	npm install -g @angular/cli

Ajout de "ng" dans le Path, en y ajoutant son chemin:
	PATH		...;C:\Users\524286135\AppData\Roaming\npm


------- Problème de Node-SASS

"npm install" retourne une erreur car il n'arrive pas à accéder à Github...

Il faut retrouver les paramètres du Proxy dans Chrome:
	chrome://net-internals/#proxy

Là, on y retrouve une URL vers un fichier de configuration de Proxy:
	http://ieupdateuk.fg.rbc.com/ie/update/windows/leoproxyuk.pac

A l'intérieur, on retrouve le Proxy utilisé par Chrome:
	lnproxy.fg.rbc.com:8080

Il faut alors créer 2 nouvelles variables d'environnement en ligne de commande:
	rundll32 sysdm.cpl,EditEnvironmentVariables

	HTTPS_PROXY
	http://524286135:****@lnproxy.fg.rbc.com:8080
	
	HTTP_PROXY
	http://524286135:****@lnproxy.fg.rbc.com:8080

Puis on peut recommencer l'installation:
	npm install

Finalement, enlever les 2 variables pour ne pas foutre la merde avec les autres commandes!


------- Problème de CORS

Fermer toutes les instances de Chrome, et changer le raccourci comme suit:
	"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --disable-web-security --ignore-certificate-errors --user-data-dir


------- Project setup (NEW)

cd C:\Workspaces\cms\
git clone git@rbcgithub.fg.rbc.com:SU00/COMS_UI.git

cd C:\Workspaces\cms\COMS_UI\CMS
git checkout comsuserprofiles
git checkout it1r1mergedcode

npm install

ng serve
(npm run start)

ng serve --prod
(pour utiliser les vrais Web Services)

http://localhost:4200


------- Accès

	Jenkins
https://rbcjenkins5.fg.rbc.com:8443/job/SU00

	Nexus
http://rbcnexus.fg.rbc.com:8081/nexus/

	PCF
https://apps.sys.pcf.devfg.rbc.com

	GitHub
https://rbcgithub.fg.rbc.com/SU00

	UCD
https://rbcucd.fg.rbc.com:8443

	Swagger (DevMaple)
http://se141212.devmaple.devfg.rbc.com/ComsAPI/swagger/ui/index

Prototype Links:
	Admin:		http://se141212.devmaple.devfg.rbc.com/Coms-Prototype-Admin/ 
	Non Admin:	http://se141212.devmaple.devfg.rbc.com/Coms-Prototyp-AllUser/ 

Drive de Raymond
	\\cagevsd01.devfg.rbc.com\SU00$

	Sharepoint
https://spcollab.fg.rbc.com/project/X02_0599_Lotus/default.aspx
https://spcollab.fg.rbc.com/project/X02_0599_Lotus/Vendor%20Management/Forms/AllItems.aspx?RootFolder=%2Fproject%2FX02_0599_Lotus%2FVendor%20Management%2FTDD&FolderCTID=0x01200024E4F4310544A94598A07C8356890027&View=%7B9258727A-2F75-4813-9E48-ADE038CDD787%7D


------- Test

ng test

Pour lancer un test, dans le fichier "*.spec.ts", il faut préfixer le 'describe...' avec un 'f':
	...
	fdescribe('...
	...


------- All Users

COMS_UI\CMS\src\user-profiles\pages\user-profile-search\user-profile-search.component.html

	Création de components
cd C:\Workspaces\cms\COMS_UI\CMS
ng generate component user-profiles\portlets\search-user-by-portlet
ng generate component user-profiles\portlets\all-users-table-portlet
+ déplacer les fichiers qui sont créés au mauvais endroit
+ MAJ app.modules.ts


------- Audit Trail

cd C:\Workspaces\cms\COMS_UI\
ng generate component user-profiles\pages\audit-trail
+ déplacer les fichiers qui sont créés au mauvais endroit
+ MAJ app.modules.ts


------- Divers

	Angular CLI
https://github.com/angular/angular-cli

	Node.js
https://nodejs.org/en/download/

	Style Guides:
http://rbcwm-styleguide.azurewebsites.net/

	Accessibility Guidelines:
http://rbcnet.fg.rbc.com/accessibility/file-600686.pdf 

	Bootstrap
https://getbootstrap.com/docs/4.2/getting-started/introduction/

	ng-Bootstrap
https://ng-bootstrap.github.io/#/getting-started


------- TODO

User connecté sélectionné par défaut dans la dropdown
Premiere valeur sélectionnée par défaut dans l'administration

	Nico
525295622
	Sharma, Vivek Kumar
332977974



...



	ISO Login UI (2FA)
--------------------------

------- TL;DR

Externalisation des pages de Login d'ISO vers une application Angular.


------- Project setup

ng new login-ui
	-> Router
	-> CSS

npm install @ngx-translate/core --save
npm install @ngx-translate/http-loader

	Install de la merde RBC One...
https://rbcone-toolkit.apps.pcf.devfg.rbc.com/#/catalog/intro/getting-started


------- Environment setup: Login UI

git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/LoginUI.git

npm install

http://localhost:4200


------- Environment setup: ISO Legacy

Lancer les 2 .bat de création du Workspace local:
	clone_projects.bat
	checkout_develop.bat

[
	OU s'amuser à faire ça manuellement sur tous les projets...
	git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/RDOweb.git
	cd RDOweb
	git checkout develop
]


------- Environment setup: Login Service

git clone git@rbcgithub.fg.rbc.com:ZXN0-ISO/LoginService.git

Eclipse: Window -> Preferences
	...

Workspace:
	C:\Workspaces\LOGIN_SERVICE

Import Existing Maven Project:
	C:\Workspaces\LOGIN_SERVICE\LoginService

Maven -> clean install

[
En cas de problèmes de Path:
	Dans les Properties du projet -> Java Build Path
	Remettre correctement les Path vers:
		LoginService\src\main\java
		LoginService\src\main\resources
]

Clic droit sur "LoginService\src\main\java\com\rbc\iso\loginsrvc\Application.java"
	-> Run As -> Spring Boot App


------- PCF Build: Login UI

Changer l'environnement dans (DEV ou QA):
	environment.prod.ts

Build the application:
	[npm install]
	[ng build --prod --base-href /proxy/login-ui/]
	ng build --prod --base-href /proxy/login-ui/ --outputHashing all

Go to the dist folder:
	cd dist\login-ui

Create an the empty FILE:
	"Staticfile"

	The PCF Web Console is:
https://apps.sys.pcf.devfg.rbc.com

Connect to PCF:
	cf login -a api.sys.pcf.devfg.rbc.com
	3. ZXN0
	2. zxn0_dev_int

Push to PCF:
	cf push login-ui

[Pour Giam, il faut compresser tout le contenu de "dist\login-ui" et le nommer "login-ui.zip"]

Logs:
	cf logs login-ui --recent

URL:
	https://login-ui.apps.pcf.devfg.rbc.com


------- PCF Build: Login Service

Dans Eclipse:
	Clic droit sur le projet
	-> Run As
	-> Maven build...
		Goals:		clean install
		User settings:	C:\Users\524286135\.m2\settings-for-maven3.xml

Le JAR se retrouve dans "LOGIN_SERVICE\LoginService\target\LoginService-0.0.1-SNAPSHOT.jar".

Push to PCF:
	cf push login-service -p LoginService-0.0.1-SNAPSHOT.jar

Logs:
	cf logs login-service --recent


------- DEV: Confirm Personal Verification Question

Postman:
	GET:		http://localhost:8080/answerPvq
	HEADER:		iso-userpermctxt-id = 0
	
	POST:		http://localhost:8080/confirmPvq
	BODY:		[JSON]

	Legacy
AnswerMyVerificationQuestion.html
AnswerMyVerificationQuestion.java

	RETRIEVE
-> PasswordServiceImpl.getRandomVerificationQuestion()
-> AdministrationDAOImpl.getVerificationUserAnswers()

	CONFIRM
-> AnswerMyVerificationQuestion.save()
-> PasswordServiceImpl.validateVerificationAnswer(getVerificationUserAnswerVO())

Il faut d'abord se conntecter avec Root en DEV avant de pouvoir tester...

Local:
	http://localhost:4200/#/pvq-answer
DEV:
	https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/pvq-answer

Pet -> blacky
City -> pune
Employer -> bljc


------- DEV: View Terms and Conditions

ng generate component view-conditions

Local:
	http://localhost:4200/#/view-conditions
DEV:
	https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/view-conditions

LEGACY:
	ViewUsageAgreement.java
	ReferenceDataServiceImpl.getUsageAgreementText()

Insertion des conditions Françaises:
	INSERT INTO RDIS_BLOB(BLOB_ID, BYTES, BLOB_SIZE, CONTENT_TYPE, FILENAME, PERMANENT, CREATED_DATE)
	VALUES (RDIS_BLOB_SEQ.nextval, utl_raw.cast_to_raw('CONDITIONS GENERALES DE INVESTOR SERVICES ONLINE'), 39429, 'text/plain', NULL, 'Y', sysdate);
	
	INSERT INTO USAGE_AGREEMENT(USAGE_AGREEMENT_ID, CREATED_USER_ID, CREATED_DATE, LAST_UPDATED_USER_ID, LAST_UPDATED_DATE, CONTENT_BLOB_ID)
	VALUES ('USAGE_AGREEMENT_FR', 0, sysdate, 0, sysdate, RDIS_BLOB_SEQ.currval);
	
	Puis coller le contenu de la Prod dans 'RDIS_BLOB.BYTES'
	https://online.rbcits.com/rdis/ViewUsageAgreement.html

Traductions existantes:
	SELECT *
	FROM LANG_TABLE_ROW_TRANSLATION
	WHERE table_name LIKE 'usage_agreement'
	;


------- DEV: Accept Terms and Conditions

ng generate component accept-conditions

Local:
	http://localhost:4200/#/accept-conditions
DEV:
	https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/accept-conditions

LEGACY:
	AcceptUsageAgreement.java
	getPasswordService().acceptUsageAgreement();


------- How to add the Chorus certificate in the Jave Keystore...

First, retrieve the Chrous certificate and save it locally.
In Chrome, go to "https://chorus.devfg.rbc.com".
Then click on the padlock -> Certificate -> Details -> Copy to File...
	DER Encoded Binary X.509 (.CER)
	C:\Tools\certificate\chorus.cer

Identify the JDK used in the Eclipse's Preferences.
Given the fact that we cannot write to the default Java folder, we first need to copy it in a place where we have Write access.
	So copy "C:\Program Files\Java\jdk1.8.0_201"
	To "C:\Tools\java\jdk1.8.0_201"

In a console, go to the new JDK:
	cd C:\Tools\java\jdk1.8.0_201\bin
	keytool -import -trustcacerts -keystore C:\Tools\java\jdk1.8.0_201\jre\lib\security\cacerts -storepass changeit -alias chorus -file C:\Tools\certificate\chorus.cer

Change Eclipse's JRE with the newly configured one.


------- Accès

	Folder
H:\My Documents\Projects\LoginUI

	Workspace
C:\Workspaces\ISO\

	Github
https://rbcgithub.fg.rbc.com/ZXN0-ISO/LoginUI
https://rbcgithub.fg.rbc.com/ZXN0-ISO/LoginService
https://rbcgithub.fg.rbc.com/ZXN0-ISO/RDOweb


------- Divers

On a toujours le problème de Node-SASS!

	Composants RBC One
https://rbcone-toolkit.apps.pcf.devfg.rbc.com/#/catalog/intro/toolkit
https://rbcgithub.fg.rbc.com/Innersource-Commons/rbcone-platform

	Pour tester les services REST
https://resttesttest.com

	Installation de Spring Tool Suite
https://spring.io/tools

Plugin pour tester les REST Services: Postman
Plugin pour tester l'appli localement: RBC Modify Header


------- TODO

Créer une Branch 'develop' dans Github

Faire logging correct!

	LOCAL
http://localhost:4200/#/login-basic
http://localhost:4200/#/login-passcode
http://localhost:4200/#/login-secure
http://localhost:4200/#/token/soft-token
http://localhost:4200/#/token/soft-token/(wizardContent:check-list)
http://localhost:4200/#/token/soft-token/(wizardContent:pin)
http://localhost:4200/#/pvqs/pvqs
http://localhost:4200/#/pvqs/pvq-answer
http://localhost:4200/#/conditions/view-conditions
http://localhost:4200/#/conditions/accept-conditions
http://localhost:4200/#/password/change-password
http://localhost:4200/#/password/set-new-password?token=56sf4sd56f4sd56
http://localhost:4200/#/password/reset-password

	DEV
https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/
https://ulvzxnad0004.devfg.rbc.com/proxy/login-passcode/
https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/token/soft-token
https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/pvqs/pvq-answer
https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/#/pvqs/pvqs

	InVision link:
https://rbc.invisionapp.com/share/BXRPAMIUFND

	Création d'un utilisateur dans RSA (via Chorus)
http://localhost:8080/initWizard
https://chorus.devfg.rbc.com/api/2fa/external/user/ISO01

	Specs 2FA
https://spcollab.fg.rbc.com/Team/X08_0675_PSD2/Requirements/UIM/

	Configuration de Postman pour récupérer le Token
https://rbc-confluence.fg.rbc.com:8443/display/ISO/RSA+Chorus+API+Information

	Chorus Swagger
https://chorus.devfg.rbc.com/api/2fa/swagger-ui.html#/
https://chorus.saifg.rbc.com/api/2fa/swagger-ui.html#/

	Folders partagés
\\MQ94943V\sharedfolder\2fa\
\\MQ94943V\sharedfolder-hungchau

	URL (DEV)
https://ulvzxnad0004.devfg.rbc.com/proxy/login-ui/

	Alex DEV RSA
alex.ac.lee@istrbc.com
GO.fishing7

hardtoken
Password1

scubidou@scuba.com
Password19

softoken
Password1

Bank_CompanyUserWithoutTM
Welcome19



...



	External Position Repository (EPR)
------------------------------------

------- TL;DR

The purpose of EPR(external position repository) is to mirror, for all RBC IS Bank clients, the securities and cash positions (eg: Collateral) that are held outside the RBC network.
RBC IS also has the duty to monitor and control those assets, this is mainly done by Trustee, Depository and Fiduciary services (TDS) team. Linked to UCITS V/AIFMD regulation.


------- Accès

LOCAL
http://localhost:4200

DEV
https://rbc-epr-dev.apps.pcf.devfg.rbc.com
	DEVPINE

TEST
https://rbc-epr-test.apps.pcf.devfg.rbc.com
	DEVPINE

QA
https://rbc-epr-qa.apps.pcf.devfg.rbc.com/#/view-cash-transactions
	STWU0SRV_USR_STD_LE2
	Password$178760

	TTWU0S01_RO
	QF@Pra67nk89

	STWU0SRV_USR_SUP1
	Password!220325

	STWU0SRV_USR_SUP1 
	Password!220325

	323894238 (Dinesh)
	May*2019


------- Database

DEV:
	server:		yke0-d14gp0101.devfg.rbc.com\IN01
	database:	DTWU0
	user name:	DTWU0S01-DEPLOY

TEST:
	server:		yke0-d14gp0101.devfg.rbc.com\IN01
	database:	DTWU0_TEST
	user name:	DTWU0S01-TEST-DEPLOY

QA:
	server:		yke0-q14gp0101.saifg.rbc.com\IN01
	database:	DTWU0
	user name:	STWU0S01-DEPLOY


------- Environment Setup

Cloner tous les projets EPR, comme indiqué dans le Wiki...
A l'aide d'un fichier Batch (clone_projects.bat).
Plus faire un Checkout de tout (checkout_master.bat).

Dans Eclipse -> Import Maven Projects...
Configurer Maven: C:\localapp\EPR\maven3.6

Pour le Build, il faut faire un 'clean install' sur le projet 'rbc-epr-parent'.

Pour le UI, se placer dans le projet "rbc-epr-ui", puis:
	npm install

Il faut récupérer le "node_modules" de Dimitri, sinon ça ne démarre pas!

...


------- Déployement temporaire (Services)

mvn --settings "C:\Users\524286135\.m2\settings-for-maven3.xml" clean install -Pmssql -Dcheckstyle.skip -DskipTests

cd target
cf login -a api.sys.pcf.devfg.rbc.com

cf push rbc-epr-transaction-jms-interface -p rbc-epr-transaction-jms-interface-1.0.0-SNAPSHOT.jar
cf push rbc-epr-business-logic -p rbc-epr-business-logic-0.0.1-SNAPSHOT.jar


------- Déployement temporaire (UI)

npm run build:prod

cd dist

Create an the empty FILE:
	"Staticfile"

cf login -a api.sys.pcf.devfg.rbc.com

cf push rbc-epr-ui


------- UI startup

cd c:\workspace\EPR\rbc-epr-ui
ng serve


------- Liens

	Wiki
https://rbcgithub.fg.rbc.com/ZXN0-ISO/ISO-wiki/wiki/EPR-links
https://rbcgithub.fg.rbc.com/ZXN0-ISO/ISO-wiki/wiki/EPR-development-environment-installation

	Sharepoint
https://spcollab.fg.rbc.com/team/H30_ACE2/scuba/BLS_PgmMgmt/Forms/AllItems.aspx?RootFolder=%2fteam%2fH30_ACE2%2fscuba%2fBLS_PgmMgmt%2fPhase%202%20Delivery%20Streams%2fEPR

	Rally
https://rally1.rallydev.com/slm/login.op

	Github
https://rbcgithub.fg.rbc.com/TWU0

	Jenkins
https://jenkins-sai-cl1-twu0-jenkins.apps.c1-ocp-dc1.saifg.rbc.com

	UCD
https://rbcucd.fg.rbc.com:8443

	PCF
https://apps.sys.pcf.devfg.rbc.com/organizations/037c4804-0229-42ed-b2a8-8e6411c9a048


------- Divers

Il est nécessaire de se connecter en DEV puis de ré-utiliser le même Browser pour se connecter au UI local...

SQL Server: F5 pour exécuter la requête.

Il est nécessaire de se synchroniser avec Git projet par projet...

Pour démarrer un des services:
	Lancer service "Eureka"
	Lancer service "Transactions"
	http://localhost:12001/security-movements?size=100&status=&workflowStatus=&currencyCode=AED

Build maven -> En ligne de commande!
	cd rbc-epr-acc-service
	mvn --settings "C:\Users\524286135\.m2\settings-for-maven3.xml" -Dmaven.test.skip.exec=true clean install

Déploiement:
	Jenkins -> Retrouver le numéro du dernier Build Master qui a fonctionné...
https://twu0-sai-cl1-rck0-jenkins.apps.c1-ocp-dc1.saifg.rbc.com
	UCD -> Voir doc Dimitri
https://rbcucd.fg.rbc.com:8443

Pousser des messages en DEV:
	Depuis PCF
	Sélectionner le service "rbc-epr-transaction-jms-interface" -> Services
	Clic sur "Rabbit MQ" -> Manage
	Aller dans "Queues" et sélectionner la première "QTWU0.IN.CASH"
	Dans la section "Publish Message", il est possible d'y placer directement un XML...
	Il faut spécifier un Header: content_type = text/text
	Changer la date: <MessageId>2019091303550000001</MessageId>
	Changer la référence Milvus: <MilvusTrxRef>DDV027</MilvusTrxRef>

Creation de la branche pour le UI:
	git clone git@rbcgithub.fg.rbc.com:TWU0/rbc-epr-ui.git
	git checkout -b CS1.3
	git push --set-upstream origin CS1.3


------- Développements

	US182580: Back Button
	---------------------

Cash -> View positions -> [Choisir un Account] -> [Clic sur la position]
Securities -> View positions -> [Choisir un Account] -> [Clic sur la position]

Nouveau 'FormHistoryService'


	US228740: Service Java (SecurityRestController)
	-----------------------------------------------

As an EPR user, I need to be able to enter a Security ID in Add Transaction Screen with any of the existing code (ISIN, CUSIP, SEDOL, MDF etc).
As of now, EPR is only letting the user entering the MDF ID in the fields "Security Ref Type" and "Security Ref".
EPR should let the user enter all the available code :
	CA Cusip
	International Cusip
	ISIN
	MDF Id
	Sedol
	Traded Sedol
	US Cusip
If the code that is used is not defined in the database then EPR should raise an error message saying : "the security ID entered does not exist in EPR"

Ecran: Securities -> Add Transaction

Service à démarrer: Eureka + Securities-Service

	URL appelé
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/securities-service/securities?ref=123&refType=MDF_ID
http://localhost:12004/securities?ref=10000001&refType=MDF_ID
http://localhost:12004/securities?ref=123&refType=ISIN

UPDATE security_market_reference
SET market_id = 'IC'
WHERE market_id = 'ISIN'
;

UPDATE security_market_reference
SET market_id = 'US'
WHERE market_id = 'US_CUSIP'
;

UPDATE security_market_reference
SET market_id = 'CA'
WHERE market_id = 'CA_CUSIP'
;

UPDATE security_market_reference
SET market_id = 'U*'
WHERE market_id = 'INTERNATIONAL_CUSIP'
;

UPDATE security_market_reference
SET market_id = 'GB'
WHERE market_id = 'SEDOL'
;

UPDATE security_market_reference
SET market_id = 'TS'
WHERE market_id = 'TRADED_SEDOL'
;


	US170276: Instructions
	----------------------

As an EPR user, I want to select an item from the Instruction List Screen and display it

-> Se baser sur "View Cash Transactions" (transaction-view.component.*)

Modifications dans:
	instructions-view.component.*
	instructions.component.*
	...

Il a fallu overrider quelques CSS dans "instructions-view.component.scss"...


	US190982: Instructions Resubmit
	-------------------------------

As an EPR User, I want to repair and resubmit an instruction (NEWM) that has failed validation.

UI:
	transaction-view.component.ts
	IInstructionItem.ts
	form-config.ts
	instructions.component.*
	form-states.ts
	instructions-view.component.*
	movements-list.component.ts
	action-links.ts
	...

DB:
	2019_10_14_1611__added_internal_remark_to_transaction_stored_message.yaml
	db.changelog-master.yaml
	...

Java:
	InstructionController.java
	InstructionsService.java
	TransactionStoredMessage.java
	CashTransactionStoredMessage.java
	SecurityTransactionStoredMessage.java
	SecurityInstructionDtoMapper.java
	CashInstructionDtoMapper.java
	InstructionDto.java
	...


	Merge des Micro-Services
	------------------------

Nouveau projet "rbc-epr-business-logic" contenant:
	rbc-epr-acc-service
	rbc-epr-transaction-service
	rbc-epr-securities-service
	rbc-epr-business-date-service
	...

	Création d'une nouvelle branche
cd <projet>
git pull
git checkout -b CS1.3
git push origin CS1.3

	Conversion des Interfaces Feign:
AccountClientImpl
ClientClientImpl
CounterpartyClientImpl
ExternalReferenceClientImpl


	Extract CSV
	-----------

-> The action button "EXPORT" should be added to every list screens:
 - view cash positions
 - view securities positions

	CASH
positions-search-bar.component.*
positions.service.ts

	SECURITIES
positions-search-bar.component.*
positions.service.ts

	Nouveaux services
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/cash-positions/generateExtract
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/security-positions/generateExtract

	Exemples d'URLs
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/cash-positions/generateExtract?clientId=3&currencyCode=BAM&positionDate=2019-11-18
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/security-positions/generateExtract?clientId=3&productCode=CTRFND-DEPLOA&positionDate=2019-11-18


-> The exports should be stored under The "reporting" tab of the EPR menu. 

cd rbc-epr-ui\src\app\components\reporting
ng generate component extraction-report\data-extraction-report --flat

	MENU
app.maps.ts

	RAPPORT
data-extraction-report.component.*
reporting.module.ts

	SERVICE
extractions-service.ts
IExtraction.ts

	Download URL
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/data-extract/34/download

	Delete URL
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/transaction-service/data-extract/38/delete


	Extract CSV (suite...)
	-----------

-> The action button "EXPORT" should be added to every list screens:

	-> Divers
cash.module.ts

	-> view cash transactionsRbc*00
search-bar.component.*
transactions.service.ts

	-> view securities transactions
search-bar.component.*
transactions.service.ts

	-> view cash movements
search-bar.component.*
movements.service.ts

	-> view securities movements
search-bar.component.*
securities.service.ts

	-> view account
account-search-bar.component.*
account.service.ts

	-> view counterparties
search-bar.component.*
counterparty.service.ts

	-> view business rules
search-bar.component.*
business-rules.service.ts

	-> view external references
external-references-search-bar.component.*
external-references.service.ts

	-> view instructions
instructions-search-bar.component.*
instructions.service.ts


	Extract CSV (Business Rules)
	-----------

Classes modifiées (UI)
	search-bar.component.ts
	spec-builder.ts
	
Classes modifiées (Serveur)
	BusinessRuleSearchCriteria
	BusinessRuleMirrorFields
	BusinessRuleMirrorTransactionType

	Label					Valeur			UI					Service					Type			BD
	-----					------			--					-------					----			--
1. Portfolio				3			clientId				clientId				Incoming		[incoming_client_id]
2. Counterparty				2			counterpartyId				counterpartyId				Incoming		[incoming_counterparty_id]
3. Status				ACTIVE			status					status								[status]
4. Mirror Transaction Type		CC			mirrorTransactionType			mirrorTransactionType			MIRROR			[mirror_transaction_type]
5. Source Economic Reason Code		dsad			sourceEconomicReasonCode		sourceEconomicReasonCode		Incoming		[incoming_source_economic_reason_code]
6. Economic Reason			OTCD			mirrorEconomicReasonCode		[mirrorEconomicReasonCode]		MIRROR			[mirror_economic_reason_code]
7. Workflow Status			VER			workflowStatus				workflowStatus							[workflow_status]


	US238332: Logout
	----------------

-> As an EPR system I need a logout button.
This button should be at the top right of the screen and by clicking on it, EPR user should be disconnected from it's session and taken back to the login screen.
Also when a session is stopped for inactivity or any other reason, the EPR system should automatically take the user back to that login screen.
(as of now there is an error message that is raised and user has to click on F5 to refresh the screen)

	UI
navigation-bar.component.*
user-profile.service.ts

	Service
CommonSecurityConfigurer.java

	URL:
https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/current-user/logout

...


	US179107: Copy Account
	----------------------

-> As an EPR user I need to be able to copy an Existing Account set up using a Copy Function.
   This functionnality will be available at the time of input (SAVE + COPY) or in the display screen (COPY).
   All the fields will be populated with the same data contained in the copied account and will be editable except:
    - Type
    - Managed Portfolio
    - Legal Entity
    - Counterparty

	Save + Copy
account-add.component.*
account-form.component.*
select-wrapper.component.html

	Copy
account-view.component.*
disabled-fields.ts
form-config.ts


	US243844: Export Client
	-----------------------

-> As an EPR user I need the export functionnality in the view client screen.
   This is already implemented in all other view screen so it should be implemented the same way.

Avec process de queuing!

	UI
search-bar.component.*
client.service.ts

	Serveur
...


	US169359: Edit External References
	----------------------------------

-> As an EPR user, I want to be able to edit the external references.
   The display screen will open and I will have an EDIT button at the bottom left of the screen.
   By clicking on EDIT only the filed "External Reference" will become editable.

	UI
external-references-view.component.*
form-states.ts
disable-fields.ts

	Serveur
ExternalReferenceStateMachine.java
ExternalReference.java
ExternalReferenceEditDto.java
ExternalReferenceController.java
ExternalReferenceFacade.java
ExternalReferenceService.java


	US169020: Reconciled columns
	----------------------------

-> Remove the Reconciled Indicator and Last Reconciled columns on the Cash Positions and Securities Positions screens.
   Those can be also removed from the Data Base.

	UI
cash-position.ts
list-config.ts
security-position-list-item.ts
list-config.ts

	Serveur
Position.java
PositionDto.java
CashPosition.java
CashPositionDto.java
CashPositionMapper.java
CashPositionDataExtractMappingStrategy.java
SecurityPosition.java
SecurityPositionDto.java
SecurityPositionMapper.java
SecurityPositionDataExtractMappingStrategy.java
CashTransactionPostStatusChangeService.java
SecurityTransactionPostStatusChangeService.java
CashPositionDefault.java
SecurityPositionDefault.java
SecurityPositionRepositoryImpl.java

	SQL
2020_02_25_1332__remove_reconcilied_columns.yaml


Vérification dans la DB:
	SELECT *
	FROM cash_position
	;

	SELECT *
	FROM security_position
	;


	US156443: Clients input
	-----------------------

-> Input of client hierarchy to be reviewed: allow a client to be set up even if parents is in "waiting for verification" status.

	UI
client.component.ts
client.service.ts

	Service
ClientController.java
ClientRepository.java
ClientService.java
ClientViewService.java

SQL:
	-- 10.839 results
	SELECT *
	FROM client
	WHERE workflow_status = 'VER'
	AND current_version = 1
	AND status = 'ACTIVE'
	;
	
	-- 11.343 results
	SELECT *
	FROM client
	WHERE (workflow_status = 'VER'
		OR workflow_status = 'WVR'
	)
	AND current_version = 1
	AND status = 'ACTIVE'
	;


	US246943: Accounts duplicates
	-----------------------------

-> As an EPR system, I need to validate that the account that is being created is not a duplicate.
   When user is creating an account (when clicking on SAVE button), EPR needs to check that if for the following combination there is no account in "verified" or "waiting verification" status that already exists. 
	- Account Type
	- Product Code
	- Managed Portfolio
	- Counterparty
	- Currency
	- Legal Entity

	UI
account-add.component.ts
http-error.interceptor.ts

	Service
AccountController.java
AccountRepository.java
AccountService.java
GlobalRestExceptionHandler.java

SQL:
	SELECT type, 
		product_code, 
		client_id, 
		counterparty_id, 
		currency_code, 
		legal_entity,
		workflow_status
	FROM account
	;


	US246945: Linked Accounts
	-------------------------

-> As an EPR user, I need to be able to see accounts linked to a Fund or a Sub Fund.
   In the view account list screen, if in the client search criteria I put a fund or a sub fund I need to be able to see all the accounts linked to the managed portfolios linked to the selected subfund or fund.

Hiérarchie:
	Fond
	Sous-fond
	Managed Portfolio

https://rbc-epr-dev.apps.pcf.devfg.rbc.com/api/acc-service/accounts?size=100&status=&workflowStatus=VER&clientId=64
-> AccountController.list()
-> Lists paginated accounts by chosen search criteria, found result count {}



id	sub_type		name			parent_id
--	--------		----			---------
265	FUND			1542105598937_CL_NAME	NULL
2	SUB_FUND		1542105599840_CL_NAME	265
3	MANAGED_PORTFOLIO	1542105600719_CL_NAME	2
2605	MANAGED_PORTFOLIO	1542105600719_CL_NAME	2
6016	MANAGED_PORTFOLIO	NewClient90		2



-- Passe un ID de parent, et il ramène toute la hiérarchie des enfants
SELECT * 
FROM client 
WHERE current_version = 1
AND (
	id = 265
	OR parent_id IN (
		SELECT id
		FROM client
		WHERE id = 265
		OR parent_id = 265
	)
)
AND sub_type = 'MANAGED_PORTFOLIO'
;


-- Même requête, sans la clause IN
SELECT child.* 
FROM client child
WHERE current_version = 1
AND (
	id = 265
	OR EXISTS (
		SELECT 1
		FROM client parent
		WHERE child.parent_id = parent.id
		AND (
			parent.id = 265
			OR parent.parent_id = 265
		)
	)
)
AND sub_type = 'MANAGED_PORTFOLIO'
;


-- Liste des Accounts liés au Client
SELECT *
FROM account
WHERE client_id IN (
SELECT child.id
FROM client child
WHERE current_version = 1
AND (
	id = 229
	OR EXISTS (
		SELECT 1
		FROM client parent
		WHERE child.parent_id = parent.id
		AND (
			parent.id = 229
			OR parent.parent_id = 229
		)
	)
)
AND sub_type = 'MANAGED_PORTFOLIO'
)
AND workflow_status = 'VER'
AND current_version = 1
ORDER BY id
;

...


------- TODO









...



	* Divers ****************************************************************************************************************
*********************************************************************************************************************************

	Liens ISO Local
-----------------------

	System Administration
http://localhost:8080/RDISinvestor/secure/admin/EnterpriseAdministration.external

	Manage Company
http://localhost:8080/RDISinvestor/secure/admin/CompanyAdministration.external

	Internal Role
http://localhost:8080/RDISinvestor/secure/admin/permission/InternalRoleAdministration.external

	Contact Us
http://localhost:8080/RDISinvestor/secure/ContactUs.html

	Preferences
http://localhost:8080/RDISinvestor/secure/MyProfile.external

	My Reports
http://localhost:8080/RDISinvestor/secure/reports/MyReports.external

	My Accounts (marche pas...)
http://localhost:8080/RDISinvestor/secure/admin/account/AccountAdministration.external?sp=l1576&sp=OrO0ABX5yAEBjb20ucmJjZGV4aWFfaXMucmRpcy5pbnZlc3Rvci5tb2RlbC5lbnVtZXJhdGlvbi5BY2NvdW50R3JvdXBUeXBlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAEVVNFUg%3D%3D&state:secure/admin/account/AccountGroupAdministration=ZH4sIAAAAAAAAAJWUMW%2FTQBTHX1JSKIEkagQSAxMLEpKNaLcubUMVBbkhSgpDF3SxT%2B6h%2BO5yPjvO0pGlAwzwLfpR%2BA4wsPIdeGcHbDelmBtsy%2Ff%2Bv3v%2F9%2B7u8ic0Fm0AaADcCSlR7tnb16GCZ64ILDV1PZow8o6FlvLwwXhMQy2UNaWEW5NVOGSjVoeNU7hPvJhwl2aTp9DOoGM6j1BKPQeaq2XILKIatp33JCb2jHDfnmjFuL%2BXSAC5uAewhUlIwpcDDzNqmTjLxFmOwKiLH5%2B%2BfnzyrQ61V9CIDSxR0MmDhlEwperD5ZfHzc%2FfL%2BoABmvG5tPFNpi8VEzViPi0JyKuwzmcw8bKyfNFF6BDXNfM9JWI5MlS0nMF%2BzeXJRAenVmURwFVRDPBrYMrjFWtADNISp6OUFSclBpuvZkcjRctgGaAyJ7gmiYaK7FzcxISLVlGYR3nsrxHbWfdmYZDB6F2AWobqP0baqfO7IIz%2B6qzPeysS0PzabxosK9H4s8A5RrjQruXC1Cf91tDp7Av0n47cNsPWJZtFXT%2FeFBAtxmfR0wt8%2FR2KjAGZRFyOoyHzD%2FTBZ%2B7lUBlFZIeMWyMIq5mMR1TKZTOkaMKyIJcpXKzyl%2BIuNwDTmI8csxLu5cv1f%2Fvxg%2BvA5kSy%2F7YHKecvf8PtrlFSuhRmWC2hFTCi1w98Mz5bDnwMDOLSTA%2FFQ0xwWy25sBd9ce3hhcVqrhWp65WhIemiMUqvazipKC0T9YppgkRP5DoKKZeIUBDt7DZD4WYIQ2jNyO8o1bGE2leW7I0fgE16hOrvQUAAA%3D%3D

	My Account Groups
http://localhost:8080/RDISinvestor/secure/admin/account/AccountGroupAdministration.external?sp=l1576&sp=OrO0ABX5yAEBjb20ucmJjZGV4aWFfaXMucmRpcy5pbnZlc3Rvci5tb2RlbC5lbnVtZXJhdGlvbi5BY2NvdW50R3JvdXBUeXBlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAEVVNFUg%3D%3D&state:secure/Dashboard=ZH4sIAAAAAAAAAJWUsW7UQBCGJyclCE7KnYiIRJGKhsorEbo0JEd0usg5nUJEi%2FbslVlk727Gu46voaRJEQryFnkU3oEUaXkHZp2A95IgzBaWZc%2F%2Fzcw%2FY1%2F%2BhNXTTQDoAQxKgZXAGc%2FESDtlS4T1T7ziUc5VFsVaZTtn11%2B%2Fn7%2F40YOVA1iteO5EjTBsg6aumAv8cnmx1f92dUbM2kBzVl6ergP0C6HcSCsrak%2FfTnQR4TxJRS35B1lGmNJFqkqUVmNkqJDIK6LDVga3vB4MYhjyJPGVjlE7c7wwwsJeTFAWQJmHst9QVuhU5Ix4hUBupVZs9w5jJ4Z%2BIkp%2Fu09hFtjDSHpYkNxSXMlGrYD0j%2Bmd4WoxSS0MY28P8%2FawxsMYHmWFvKm2C3p8OAnQA6lOnMRFW952B8ZkWUScoVSlzD7aoM%2FXnUDLKiI9lzQY5ImVlTgSRqNtkbMOyECOjdxn%2BQuR0j1TvHrPc5k202tTjf978NOHQN5iMz7yH0HLfvMP9lxwtYSeLRP8ShjUqUvsJD2Bz7AWw%2BZNs1SEzBrRlAr0C%2FM0WJh3FmWzMk%2Fwjw8WXnVw9Z5vGxa5Kr2poWtvu3QWKNnxfYofilO7hjqsRBoEWNgIetnTOicaRa85%2BtPcGlGbO%2BcXolPtk5IEAAA%3D



	* To Do *****************************************************************************************************************
*********************************************************************************************************************************

	A CLASSER
http://www.splunk.com/en_us/support-and-services.html
http://docs.splunk.com/Special:SplunkSearch/docs?q=split

Télécharger Useful References Splunk (p.10)
http://www.javacodegeeks.com/2015/12/10-awesome-angularjs-tutorials-to-kick-start-your-web-programming-projects.html

Améliorations
	Formations
	Qualité du code
	Pair programming
	Junits inutiles
	Nettoyage et centralisation de la documentation
	...

Découvrir GIT!!
https://git-scm.com/book/fr/v2
http://fabiensanglard.net/git_code_review/index.php

Formation Splunk??
Ou Dynatrace!
Formation Spring...

Faire un petit ~ sympa sur le nouveau DEV...

Faire doc de nouvelle architecture ISO!
-> Micro services, ...

Glassfish
[
Virer tout ce qu'il y a dans 
	P:\Tools\Development\glassfish4\glassfish\domains\domain1\applications
et
	P:\Tools\Development\glassfish4\glassfish\domains\domain1\applications\__internal
]
	-> Clean 
	-> Prout!!
	-> Kill 'java.exe' 
	-> Clean

Tuto IntelliJ...

	Javascript à investiguer...
Sites JavaScript ou TypeScript ou Node...
how to define function javascript
Javascript: Single-threaded et asynchrone
Javascript callback??
https://stackblitz.com/edit/angular4
Javascript this arrow functions
Javascript how to add an event in the loop?
.bind(this) ???
__proto__
Prototypal inheritance
Redux??
Reactive programming??
What is the <div> element?
you have Python installed, navigate to the root directory of your project in a terminal/command line/shell and run python -m SimpleHTTPServer
XMLHttpRequest
ret ... ?
Heroku machin??
Configurer serveur apache local?
Access-Control-Allow-Origin - CORS??
Async / Await
https://github.com/snipcart/learn-vanilla-js
Programmation fonctionnelle
Mandelbrot graphics
Moteur JavaScript Chrome & Firefox??
Syntaxe TypeScript
Pourquoi y a-t-il besoin de Callbacks en JS? A cause du fait que c'est asynchrone?
Currying?

Nouvel env. de tests!

	A installer?
https://johnpapa.net/rec-ng-extensions/

Chopper numéro WebEx pour la Belgique!

AesEncryptionHelper.java
//DO NOT CHANGE THIS!!!! it needs to remain the same constant otherwise we will lose existing encrypted data
protected static byte[] key = {43, -4, -37, 60, 19, 32, 102, -63, -115, 26, -63, -94, -45, 119, 45, -117};

48 jours télétravail!?

DIV ou SPAN?

Eviter ViewChild??

Données à chopper... mais quoi??											[*]
	Seed (où est-il?) -> AesEncryptionHelper.java
	/RDISinvestorCommon/src/main/resources/applicationContext-commonBean.xml
	table "rdis_user"
	table "company"
	table "ta_user"
	table FTP de Mike
	Document d'audit de sécurité
	PasswordServiceImpl.java 
	...
Reprendre les fichiers ISO bizbiz du répertoire du Super Converter!!

Taille du code source ISO dans Git??
Reprendre les apps Angular!
Chopper ZIPs du code Git...

Reprendre un ZIP de mes eMails!!
Reprendre le document des congés!
Et celui de "Mapping"...








...

